/*
 * @here/xyz-maps-core
 * (c) 2019-2021 HERE
 */

(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, (global.here = global.here || {}, global.here.xyz = global.here.xyz || {}, global.here.xyz.maps = factory()));
}(this, (function () { 'use strict';

    let shared;
    let worker;

    function define(_, chunk) {
        if (!shared) {
            shared = chunk;
        } else if (!worker) {
            worker = chunk || _;
        } else {
            const workerBundle = 'var shared={};(' + shared + ')(shared);(' + worker + ')(shared);';
            const sharedExports = {};
            shared(sharedExports);
            const xyzMaps = here.xyz.maps;
            xyzMaps.__workerURL = window.URL.createObjectURL(new Blob([workerBundle], {type: 'text/javascript'}));
            chunk(xyzMaps, xyzMaps.common, sharedExports);
        }
    }


    define(["exports"],function(t){"use strict";var i=(e.prototype.setUint16Array=function(t){var i=this.bO,e=t.length;this.dV.setUint32(i,e),new Uint16Array(this.aB,i+4,e).set(t),this.bO+=4+2*e;},e.prototype.setLayer=function(t,i){var e=this.dV,r=this.bO;e.setUint16(r,Number(t)),e.setUint32(r+2,i),this.bO+=6;},e.prototype.setFeature=function(t,i){this.dV.setUint16(this.bO,t),this.bO+=2,this.setUint16Array(i);},e.prototype.getLayers=function(){for(var t=this.dV,i=t.byteLength,e=0,r={};e<i;){var n=t.getUint16(e),s=2*t.getUint32(e+2);e+=6,r[n]={offset:e,length:s,features:null},e+=s;}return r},e.prototype.getFeatures=function(t){if(t.features)return t.features;for(var i=t.features={},e=this.dV,r=this.aB,n=t.offset,s=n+t.length;n<s;){var o=e.getUint16(n),h=e.getUint32(n+2);n+=6,i[o]=new Uint16Array(r,n,h),n+=2*h;}},e.prototype.getBuffer=function(){return this.aB},e);function e(t){this.bO=0,"number"==typeof t&&(t=new ArrayBuffer(t)),this.dV=new DataView(t),this.aB=t;}var r=function(t,i,e,r,n){var s,o,h=8*n-r-1,a=(1<<h)-1,u=a>>1,f=-7,p=e?n-1:0,d=e?-1:1,e=t[i+p];for(p+=d,s=e&(1<<-f)-1,e>>=-f,f+=h;0<f;s=256*s+t[i+p],p+=d,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=r;0<f;o=256*o+t[i+p],p+=d,f-=8);if(0===s)s=1-u;else {if(s===a)return o?NaN:1/0*(e?-1:1);o+=Math.pow(2,r),s-=u;}return (e?-1:1)*o*Math.pow(2,s-r)},n=function(t,i,e,r,n,s){var o,h,a=8*s-n-1,u=(1<<a)-1,f=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,c=r?1:-1,s=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(h=isNaN(i)?1:0,o=u):(o=Math.floor(Math.log(i)/Math.LN2),i*(r=Math.pow(2,-o))<1&&(o--,r*=2),2<=(i+=1<=o+f?p/r:p*Math.pow(2,1-f))*r&&(o++,r/=2),u<=o+f?(h=0,o=u):1<=o+f?(h=(i*r-1)*Math.pow(2,n),o+=f):(h=i*Math.pow(2,f-1)*Math.pow(2,n),o=0));8<=n;t[e+d]=255&h,d+=c,h/=256,n-=8);for(o=o<<n|h,a+=n;0<a;t[e+d]=255&o,d+=c,o/=256,a-=8);t[e+d-c]|=128*s;},s=o;function o(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length;}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var h=4294967296,a=1/h,u="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function f(t){return t.type===o.Bytes?t.readVarint()+t.pos:t.pos+1}function p(t,i,e){return e?4294967296*i+(t>>>0):4294967296*(i>>>0)+(t>>>0)}function d(t,i,e){var r=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));e.realloc(r);for(var n=e.pos-1;t<=n;n--)e.buf[n+r]=e.buf[n];}function c(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e]);}function l(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e]);}function y(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e]);}function w(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e]);}function g(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e]);}function x(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e]);}function v(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e]);}function b(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e]);}function F(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e]);}function V(t,i){return (t[i]|t[i+1]<<8|t[i+2]<<16)+16777216*t[i+3]}function _(t,i,e){t[e]=i,t[e+1]=i>>>8,t[e+2]=i>>>16,t[e+3]=i>>>24;}function M(t,i){return (t[i]|t[i+1]<<8|t[i+2]<<16)+(t[i+3]<<24)}o.prototype={destroy:function(){this.buf=null;},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=7&r,t(n,i,this),this.pos===s&&this.skip(r);}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=V(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=M(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=V(this.buf,this.pos)+V(this.buf,this.pos+4)*h;return this.pos+=8,t},readSFixed64:function(){var t=V(this.buf,this.pos)+M(this.buf,this.pos+4)*h;return this.pos+=8,t},readFloat:function(){var t=r(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=r(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var i=this.buf,e=i[this.pos++],r=127&e;return e<128?r:(r|=(127&(e=i[this.pos++]))<<7,e<128?r:(r|=(127&(e=i[this.pos++]))<<14,e<128?r:(r|=(127&(e=i[this.pos++]))<<21,e<128?r:function(t,i,e){var r,n,s=e.buf;if(n=s[e.pos++],r=(112&n)>>4,n<128)return p(t,r,i);if(n=s[e.pos++],r|=(127&n)<<3,n<128)return p(t,r,i);if(n=s[e.pos++],r|=(127&n)<<10,n<128)return p(t,r,i);if(n=s[e.pos++],r|=(127&n)<<17,n<128)return p(t,r,i);if(n=s[e.pos++],r|=(127&n)<<24,n<128)return p(t,r,i);if(n=s[e.pos++],r|=(1&n)<<31,n<128)return p(t,r,i);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&i[this.pos])<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t,i=this.readVarint()+this.pos,e=this.pos;return 12<=(this.pos=i)-e&&u?(t=this.buf,u.decode(t.subarray(e,i))):function(t,i,e){var r,n,s,o="",h=i;for(;h<e;){var a=t[h],u=null,f=239<a?4:223<a?3:191<a?2:1;if(e<h+f)break;1===f?a<128&&(u=a):2===f?128==(192&(r=t[h+1]))&&(u=(31&a)<<6|63&r)<=127&&(u=null):3===f?(r=t[h+1],n=t[h+2],128==(192&r)&&128==(192&n)&&((u=(15&a)<<12|(63&r)<<6|63&n)<=2047||55296<=u&&u<=57343)&&(u=null)):4===f&&(r=t[h+1],n=t[h+2],s=t[h+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&((u=(15&a)<<18|(63&r)<<12|(63&n)<<6|63&s)<=65535||1114112<=u)&&(u=null)),null===u?(u=65533,f=1):65535<u&&(u-=65536,o+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),o+=String.fromCharCode(u),h+=f;}return o}(this.buf,e,i)},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i},readPackedVarint:function(t,i){if(this.type!==o.Bytes)return t.push(this.readVarint(i));var e=f(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){if(this.type!==o.Bytes)return t.push(this.readSVarint());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==o.Bytes)return t.push(this.readBoolean());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==o.Bytes)return t.push(this.readFloat());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==o.Bytes)return t.push(this.readDouble());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==o.Bytes)return t.push(this.readFixed32());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==o.Bytes)return t.push(this.readSFixed32());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==o.Bytes)return t.push(this.readFixed64());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==o.Bytes)return t.push(this.readSFixed64());var i=f(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){t&=7;if(t===o.Varint)for(;127<this.buf[this.pos++];);else if(t===o.Bytes)this.pos=this.readVarint()+this.pos;else if(t===o.Fixed32)this.pos+=4;else {if(t!==o.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8;}},writeTag:function(t,i){this.writeVarint(t<<3|i);},realloc:function(t){for(var i,e=this.length||16;e<this.pos+t;)e*=2;e!==this.length&&((i=new Uint8Array(e)).set(this.buf),this.buf=i,this.length=e);},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4;},writeSFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4;},writeFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8;},writeSFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8;},writeVarint:function(t){268435455<(t=+t||0)||t<0?function(t,i){var e,r;0<=t?(e=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(e=~(-t%4294967296))?e=e+1|0:r=r+1|(e=0));if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(t,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t;}(e,i),function(t,i){var e=(7&t)<<4;i.buf[i.pos++]|=e|((t>>>=3)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t)))));}(r,i);}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))));},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t);},writeBoolean:function(t){this.writeVarint(Boolean(t));},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var i=this.pos;this.pos=function(t,i,e){for(var r,n,s=0;s<i.length;s++){if(55295<(r=i.charCodeAt(s))&&r<57344){if(!n){56319<r||s+1===i.length?(t[e++]=239,t[e++]=191,t[e++]=189):n=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null;}else n&&(t[e++]=239,t[e++]=191,t[e++]=189,n=null);r<128?t[e++]=r:(r<2048?t[e++]=r>>6|192:(r<65536?t[e++]=r>>12|224:(t[e++]=r>>18|240,t[e++]=r>>12&63|128),t[e++]=r>>6&63|128),t[e++]=63&r|128);}return e}(this.buf,t,this.pos);t=this.pos-i;128<=t&&d(i,t,this),this.pos=i-1,this.writeVarint(t),this.pos+=t;},writeFloat:function(t){this.realloc(4),n(this.buf,t,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(t){this.realloc(8),n(this.buf,t,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;e<i;e++)this.buf[this.pos++]=t[e];},writeRawMessage:function(t,i){this.pos++;var e=this.pos;t(i,this);i=this.pos-e;128<=i&&d(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i;},writeMessage:function(t,i,e){this.writeTag(t,o.Bytes),this.writeRawMessage(i,e);},writePackedVarint:function(t,i){i.length&&this.writeMessage(t,c,i);},writePackedSVarint:function(t,i){i.length&&this.writeMessage(t,l,i);},writePackedBoolean:function(t,i){i.length&&this.writeMessage(t,g,i);},writePackedFloat:function(t,i){i.length&&this.writeMessage(t,y,i);},writePackedDouble:function(t,i){i.length&&this.writeMessage(t,w,i);},writePackedFixed32:function(t,i){i.length&&this.writeMessage(t,x,i);},writePackedSFixed32:function(t,i){i.length&&this.writeMessage(t,v,i);},writePackedFixed64:function(t,i){i.length&&this.writeMessage(t,b,i);},writePackedSFixed64:function(t,i){i.length&&this.writeMessage(t,F,i);},writeBytesField:function(t,i){this.writeTag(t,o.Bytes),this.writeBytes(i);},writeFixed32Field:function(t,i){this.writeTag(t,o.Fixed32),this.writeFixed32(i);},writeSFixed32Field:function(t,i){this.writeTag(t,o.Fixed32),this.writeSFixed32(i);},writeFixed64Field:function(t,i){this.writeTag(t,o.Fixed64),this.writeFixed64(i);},writeSFixed64Field:function(t,i){this.writeTag(t,o.Fixed64),this.writeSFixed64(i);},writeVarintField:function(t,i){this.writeTag(t,o.Varint),this.writeVarint(i);},writeSVarintField:function(t,i){this.writeTag(t,o.Varint),this.writeSVarint(i);},writeStringField:function(t,i){this.writeTag(t,o.Bytes),this.writeString(i);},writeFloatField:function(t,i){this.writeTag(t,o.Fixed32),this.writeFloat(i);},writeDoubleField:function(t,i){this.writeTag(t,o.Fixed64),this.writeDouble(i);},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i));}};var S=B;function B(t,i){this.x=t,this.y=i;}B.prototype={clone:function(){return new B(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,i){return this.clone()._rotateAround(t,i)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var i=t.x-this.x,t=t.y-this.y;return i*i+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,i){return Math.atan2(this.x*i-this.y*t,this.x*t+this.y*i)},_matMult:function(t){var i=t[0]*this.x+t[1]*this.y,t=t[2]*this.x+t[3]*this.y;return this.x=i,this.y=t,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var i=Math.cos(t),e=Math.sin(t),t=i*this.x-e*this.y,i=e*this.x+i*this.y;return this.x=t,this.y=i,this},_rotateAround:function(t,i){var e=Math.cos(t),r=Math.sin(t),t=i.x+e*(this.x-i.x)-r*(this.y-i.y),i=i.y+r*(this.x-i.x)+e*(this.y-i.y);return this.x=t,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},B.convert=function(t){return !(t instanceof B)&&Array.isArray(t)?new B(t[0],t[1]):t};var m=k;function k(t,i,e,r,n){this.properties={},this.extent=e,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(P,this,i);}function P(t,i,e){1==t?i.id=e.readVarint():2==t?function(t,i){var e=t.readVarint()+t.pos;for(;t.pos<e;){var r=i._keys[t.readVarint()],n=i._values[t.readVarint()];i.properties[r]=n;}}(e,i):3==t?i.type=e.readVarint():4==t&&(i._geometry=e.pos);}k.types=["Unknown","Point","LineString","Polygon"],k.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var i,e,r=t.readVarint()+t.pos,n=1,s=0,o=0,h=0,a=[];t.pos<r;)if(s<=0&&(n=7&(e=t.readVarint()),s=e>>3),s--,1===n||2===n)o+=t.readSVarint(),h+=t.readSVarint(),1===n&&(i&&a.push(i),i=[]),i.push(new S(o,h));else {if(7!==n)throw new Error("unknown command "+n);i&&i.push(i[0].clone());}return i&&a.push(i),a},k.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var i,e=t.readVarint()+t.pos,r=1,n=0,s=0,o=0,h=1/0,a=-1/0,u=1/0,f=-1/0;t.pos<e;)if(n<=0&&(r=7&(i=t.readVarint()),n=i>>3),n--,1===r||2===r)(s+=t.readSVarint())<h&&(h=s),a<s&&(a=s),(o+=t.readSVarint())<u&&(u=o),f<o&&(f=o);else if(7!==r)throw new Error("unknown command "+r);return [h,u,a,f]},k.prototype.toGeoJSON=function(t,i,e){var r,n=this.extent*Math.pow(2,e),s=this.extent*t,o=this.extent*i,h=this.loadGeometry(),i=k.types[this.type];function a(t){for(var i=0;i<t.length;i++){var e=t[i],r=180-360*(e.y+o)/n;t[i]=[360*(e.x+s)/n-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90];}}switch(this.type){case 1:for(var u=[],f=0;f<h.length;f++)u[f]=h[f][0];a(h=u);break;case 2:for(f=0;f<h.length;f++)a(h[f]);break;case 3:for(h=function(t){var i=t.length;if(i<=1)return [t];for(var e,r,n=[],s=0;s<i;s++){var o=function(t){for(var i,e,r=0,n=0,s=t.length,o=s-1;n<s;o=n++)i=t[n],e=t[o],r+=(e.x-i.x)*(i.y+e.y);return r}(t[s]);0!==o&&((r=void 0===r?o<0:r)===o<0?(e&&n.push(e),e=[t[s]]):e.push(t[s]));}e&&n.push(e);return n}(h),f=0;f<h.length;f++)for(r=0;r<h[f].length;r++)a(h[f][r]);}1===h.length?h=h[0]:i="Multi"+i;i={type:"Feature",geometry:{type:i,coordinates:h},properties:this.properties};return "id"in this&&(i.id=this.id),i};var T=U;function U(t,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(A,this,i),this.length=this._features.length;}function A(t,i,e){15===t?i.version=e.readVarint():1===t?i.name=e.readString():5===t?i.extent=e.readVarint():2===t?i._features.push(e.pos):3===t?i._keys.push(e.readString()):4===t&&i._values.push(function(t){var i=null,e=t.readVarint()+t.pos;for(;t.pos<e;){var r=t.readVarint()>>3;i=1==r?t.readString():2==r?t.readFloat():3==r?t.readDouble():4==r?t.readVarint64():5==r?t.readVarint():6==r?t.readSVarint():7==r?t.readBoolean():null;}return i}(e));}U.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];t=this._pbf.readVarint()+this._pbf.pos;return new m(this._pbf,t,this.extent,this._keys,this._values)};function D(t,i){this.layers=t.readFields(N,{},i);}function N(t,i,e){3!==t||(e=new T(e,e.readVarint()+e.pos)).length&&(i[e.name]=e);}var O={VectorTile:D,VectorTileFeature:m,VectorTileLayer:T};t.VectorTile=D,t.XYZBin=i,t.pbf=s,t.vectorTile=O;});

    define(["./shared"],function(E){"use strict";var S=t,e=t;function t(e,t,n){n=n||2;var r,x,i,u,a,s=t&&t.length,f=s?t[0]*n:e.length,v=y(e,0,f,n,!0),o=[];if(!v||v.next===v.prev)return o;if(s&&(v=function(e,t,n,r){var x,i,u,a,s=[];for(x=0,i=t.length;x<i;x++)u=t[x]*r,a=x<i-1?t[x+1]*r:e.length,(a=y(e,u,a,r,!1))===a.next&&(a.steiner=!0),s.push(function(e){var t=e,n=e;for(;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next,t!==e;);return n}(a));for(s.sort(d),x=0;x<s.length;x++)!function(e,t){(t=function(e,t){var n,r=t,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var a=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=x&&u<a){if((u=a)===x){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next;}}}while(r=r.next,r!==t);if(!n)return null;if(x===u)return n;var s,f=n,v=n.x,o=n.y,h=1/0;r=n;for(;x>=r.x&&r.x>=v&&x!==r.x&&w(i<o?x:u,i,v,o,i<o?u:x,i,r.x,r.y)&&(s=Math.abs(i-r.y)/(x-r.x),b(r,e)&&(s<h||s===h&&(r.x>n.x||r.x===n.x&&function(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}(n,r)))&&(n=r,h=s)),r=r.next,r!==f;);return n}(e,t))&&(e=M(t,e),c(t,t.next),c(e,e.next));}(s[x],n),n=c(n,n.next);return n}(e,t,v,n)),e.length>80*n){for(var h=r=e[0],l=x=e[1],p=n;p<f;p+=n)(i=e[p])<h&&(h=i),(u=e[p+1])<l&&(l=u),r<i&&(r=i),x<u&&(x=u);a=0!==(a=Math.max(r-h,x-l))?1/a:0;}return g(v,o,n,h,l,a),o}function y(e,t,n,r,x){var i,u;if(x===0<z(e,t,n,r))for(i=t;i<n;i+=r)u=a(i,e[i],e[i+1],u);else for(i=n-r;t<=i;i-=r)u=a(i,e[i],e[i+1],u);return u&&v(u,u.next)&&(h(u),u=u.next),u}function c(e,t){if(!e)return e;t=t||e;var n,r=e;do{if(n=!1,r.steiner||!v(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else {if(h(r),(r=t=r.prev)===r.next)break;n=!0;}}while(n||r!==t);return t}function g(e,t,n,r,x,i,u){if(e){!u&&i&&function(e,t,n,r){var x=e;for(;null===x.z&&(x.z=Z(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next,x!==e;);x.prevZ.nextZ=null,x.prevZ=null,function(e){var t,n,r,x,i,u,a,s,f=1;do{for(n=e,i=e=null,u=0;n;){for(u++,r=n,t=a=0;t<f&&(a++,r=r.nextZ);t++);for(s=f;0<a||0<s&&r;)0!==a&&(0===s||!r||n.z<=r.z)?(n=(x=n).nextZ,a--):(r=(x=r).nextZ,s--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;n=r;}}while(i.nextZ=null,f*=2,1<u)}(x);}(e,r,x,i);for(var a,s,f=e;e.prev!==e.next;)if(a=e.prev,s=e.next,i?function(e,t,n,r){var x=e.prev,i=e,u=e.next;if(0<=m(x,i,u))return !1;var a=(x.x<i.x?x.x<u.x?x:u:i.x<u.x?i:u).x,s=(x.y<i.y?x.y<u.y?x:u:i.y<u.y?i:u).y,f=(x.x>i.x?x.x>u.x?x:u:i.x>u.x?i:u).x,v=(x.y>i.y?x.y>u.y?x:u:i.y>u.y?i:u).y,o=Z(a,s,t,n,r),h=Z(f,v,t,n,r),l=e.prevZ,p=e.nextZ;for(;l&&l.z>=o&&p&&p.z<=h;){if(l!==e.prev&&l!==e.next&&w(x.x,x.y,i.x,i.y,u.x,u.y,l.x,l.y)&&0<=m(l.prev,l,l.next))return !1;if(l=l.prevZ,p!==e.prev&&p!==e.next&&w(x.x,x.y,i.x,i.y,u.x,u.y,p.x,p.y)&&0<=m(p.prev,p,p.next))return !1;p=p.nextZ;}for(;l&&l.z>=o;){if(l!==e.prev&&l!==e.next&&w(x.x,x.y,i.x,i.y,u.x,u.y,l.x,l.y)&&0<=m(l.prev,l,l.next))return !1;l=l.prevZ;}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&w(x.x,x.y,i.x,i.y,u.x,u.y,p.x,p.y)&&0<=m(p.prev,p,p.next))return !1;p=p.nextZ;}return !0}(e,r,x,i):function(e){var t=e.prev,n=e,r=e.next;if(0<=m(t,n,r))return !1;var x=e.next.next;for(;x!==e.prev;){if(w(t.x,t.y,n.x,n.y,r.x,r.y,x.x,x.y)&&0<=m(x.prev,x,x.next))return !1;x=x.next;}return !0}(e))t.push(a.i/n),t.push(e.i/n),t.push(s.i/n),h(e),e=s.next,f=s.next;else if((e=s)===f){u?1===u?g(e=function(e,t,n){var r=e;do{var x=r.prev,i=r.next.next;}while(!v(x,i)&&o(x,r,r.next,i)&&b(x,i)&&b(i,x)&&(t.push(x.i/n),t.push(r.i/n),t.push(i.i/n),h(r),h(r.next),r=e=i),r=r.next,r!==e);return c(r)}(c(e),t,n),t,n,r,x,i,2):2===u&&function(e,t,n,r,x,i){var u=e;do{for(var a=u.next.next;a!==u.prev;){if(u.i!==a.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&o(n,n.next,e,t))return !0}while(n=n.next,n!==e);return !1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var n=e,r=!1,x=(e.x+t.x)/2,i=(e.y+t.y)/2;for(;n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||v(e,t)&&0<m(e.prev,e,e.next)&&0<m(t.prev,t,t.next))}(u,a)){var s=M(u,a);return u=c(u,u.next),s=c(s,s.next),g(u,t,n,r,x,i),g(s,t,n,r,x,i)}a=a.next;}}while(u=u.next,u!==e)}(e,t,n,r,x,i):g(c(e),t,n,r,x,i,1);break}}}function d(e,t){return e.x-t.x}function Z(e,t,n,r,x){return (e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*x)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*x)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function w(e,t,n,r,x,i,u,a){return 0<=(x-u)*(t-a)-(e-u)*(i-a)&&0<=(e-u)*(r-a)-(n-u)*(t-a)&&0<=(n-u)*(i-a)-(x-u)*(r-a)}function m(e,t,n){return (t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function o(e,t,n,r){var x=f(m(e,t,n)),i=f(m(e,t,r)),u=f(m(n,r,e)),a=f(m(n,r,t));return x!==i&&u!==a||(0===x&&s(e,n,t)||(0===i&&s(e,r,t)||(0===u&&s(n,e,r)||!(0!==a||!s(n,t,r)))))}function s(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function f(e){return 0<e?1:e<0?-1:0}function b(e,t){return m(e.prev,e,e.next)<0?0<=m(e,t,e.next)&&0<=m(e,e.prev,t):m(e,t,e.prev)<0||m(e,e.next,t)<0}function M(e,t){var n=new u(e.i,e.x,e.y),r=new u(t.i,t.x,t.y),x=e.next,i=t.prev;return (e.next=t).prev=e,(n.next=x).prev=n,(r.next=n).prev=r,(i.next=r).prev=i,r}function a(e,t,n,r){n=new u(e,t,n);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n}function h(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ);}function u(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function z(e,t,n,r){for(var x=0,i=t,u=n-r;i<n;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}t.deviation=function(e,t,n,r){var x=t&&t.length,i=x?t[0]*n:e.length,u=Math.abs(z(e,0,i,n));if(x)for(var a=0,s=t.length;a<s;a++){var f=t[a]*n,v=a<s-1?t[a+1]*n:e.length;u-=Math.abs(z(e,f,v,n));}for(var o=0,a=0;a<r.length;a+=3){var h=r[a]*n,l=r[a+1]*n,p=r[a+2]*n;o+=Math.abs((e[h]-e[p])*(e[1+l]-e[1+h])-(e[h]-e[l])*(e[1+p]-e[1+h]));}return 0===u&&0===o?0:Math.abs((o-u)/u)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<t;u++)n.vertices.push(e[x][i][u]);0<x&&(r+=e[x-1].length,n.holes.push(r));}return n},S.default=e;function B(e){var t=e.length;if(t<=1)return [e];for(var n,r,x=[],i=0;i<t;i++){var u=function(e){for(var t,n,r=0,x=0,i=e.length,u=i-1;x<i;u=x++)t=e[x],n=e[u],r+=(n[0]-t[0])*(t[1]+n[1]);return r}(e[i]);0!==u&&((r=void 0===r?u<0:r)===u<0?(n&&x.push(n),n=[e[i]]):n.push(e[i]));}return n&&x.push(n),x}function l(e,t,n,r){var x,i=new E.VectorTile(new E.pbf(e)),u={},a=0,s=0,f=0;for(x in i.layers){for(var v=i.layers[x],o=0,h=u[a++]={length:0,features:{}};o<v.length;){if(3==(L=v.feature(o)).type){for(var l=[],p=[],y=0,c=0,g=B(function(e){var t=e._pbf;t.pos=e._geometry;for(var n,r,x=t.readVarint()+t.pos,i=1,u=0,a=0,s=0,f=[];t.pos<x;)if(u<=0&&(i=7&(r=t.readVarint()),u=r>>3),u--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(n&&f.push(n),n=[]),n.push([a,s]);else {if(7!==i)throw new Error("unknown command "+i);n&&n.push(n[0].slice());}return n&&f.push(n),f}(L));c<g.length;c++){var d=function(e,t){void 0===t&&(t=[]);for(var n=[],r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)t[t.length]=e[x][i][0],t[t.length]=e[x][i][1];0<x&&(r+=e[x-1].length,n[n.length]=r);}return {vertices:t,holes:n,dimensions:e[0][0].length}}(g[c]),Z=S(d.vertices,d.holes,d.dimensions);p.push(y);for(var w=0,m=Z;w<m.length;w++){var b=m[w];l[l.length]=y+b;}y+=d.vertices.length/d.dimensions;}h.features[o]={tris:l,verts:[],polys:p,holes:[]},h.length+=l.length+2+1;}o++;}h.length&&(f++,s+=2*h.length);}var M=new E.XYZBin(6*f+s);if(0<s)for(var z in u){var T=(h=u[z]).length;if(T){M.setLayer(z,T);var V,k=h.features;for(V in k){var L,Z=(L=k[V]).tris;M.setFeature(Number(V),Z);}}}return M.getBuffer()}var p=new Map;self.addEventListener("message",function(e){var t,n,r,x=e.data,e=x.msg,i=x.url;switch(e){case"abort":var u=p.get(i);u&&(u.abort(),p.delete(i));break;case"load":p.set(i,(t=i,n=function(e){var t=l(e,x.x,x.y,x.z);p.delete(i),self.postMessage({msg:"success",url:i,data:e,triangles:t},[e,t]);},r=function(e){p.delete(i),self.postMessage({msg:"error",url:i,data:e});},(u=new XMLHttpRequest).responseType="arraybuffer",u.onload=function(){var e,t;200<=this.status&&this.status<=226&&(t=(e=this.response).byteLength,n(e,t));},u.onreadystatechange=function(){4==this.readyState&&(this.status<200||300<=this.status)&&(this.onload=null,0!==this.status&&r&&r({status:this.status,statusText:this.statusText}));},u.open("GET",t,!0),u.send(null),u));}});});

    define(["exports","@here/xyz-maps-common","./shared"],function(t,y,a){"use strict";function e(r){if(r&&r.__esModule)return r;var o=Object.create(null);return r&&Object.keys(r).forEach(function(t){var e;"default"!==t&&(e=Object.getOwnPropertyDescriptor(r,t),Object.defineProperty(o,t,e.get?e:{enumerable:!0,get:function(){return r[t]}}));}),o.default=r,Object.freeze(o)}var r=e(y),o=function(t,e){return (o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);})(t,e)};
    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t;}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r);}function i(t,e){this.x=t,this.y=e;}function s(t,e,r,o){this.minX=t,this.minY=e,this.maxX=r,this.maxY=o;}function l(t,e){this.longitude=t,this.latitude=e;}function p(t,e,r,o){this.minLon=t,this.minLat=e,this.maxLon=r,this.maxLat=o;}var d=function(){return (d=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},u=[{zIndex:0,type:"Circle",radius:6,fill:"#ff0000"}],h=[{zIndex:0,type:"Line",strokeWidth:10,stroke:"#ff0000"}],c=[{zIndex:0,type:"Polygon",strokeWidth:1,stroke:"#ffffff",fill:"#ff0000"}],f={styleGroups:{Point:u,MultiPoint:u,LineString:h,MultiLineString:h,Polygon:c,MultiPolygon:c},assign:function(t){return t.geometry.type}};function v(t,e){for(var r in e)t[r]=e[r];return t}var g=[],m=(x.prototype.assign=function(t,e){return t.geometry.type},x.prototype.getStyleGroup=function(t,e,r){var o=this._c[t.id];return o=(null==o||r)&&"object"!=typeof(o=this.assign(t,e))?this.styleGroups[o]:o},x.prototype.setStyleGroup=function(t,e,r){var o=t.id,n=this._c;return (e=e&&r?this.merge(this.getStyleGroup(t),e):e)?n[o]=e:null===e||!1===e?e=n[o]=g:n[o]&&delete n[o],e},x.prototype.merge=function(t,e){if(null===e||!1===e)return null;for(var r,o=[],n=0,i=t.length;n<i;n++)r=v({},t[n]),e[n]&&v(r,e[n]),o[n]=r;return o},x);function x(t,e){this.styleGroups=null,this._c=null;var r,o=function(t,e){if("object"!=typeof t||null===t)return t;for(var r in e=e||(Array.isArray(t)?[]:{}),t)e[r]=o(t[r]);return e};for(r in t)this[r]="styleGroups"==r?o(t.styleGroups,{}):t[r];this._c=e||{};}var _,b="featureRemove",L="featureAdd",w="featureCoordinatesChange",T="styleGroupChange",M="styleChange",P="clear",S=(E.prototype.getProvider=function(t){return t?this._p[Math.floor(t)-this.levelOffset]:this._fp},E.prototype.addEventListener=function(t,e,r){var o=this._l;return o.isDefined(t)?o.add(t,e,r):this._fp&&this._fp.addEventListener(t,e,r)},E.prototype.removeEventListener=function(t,e,r){var o=this._l;return o.isDefined(t)?o.remove(t,e,r):this._fp.removeEventListener(t,e,r)},E.prototype._eventProxy=function(t){var e=t.type,r=t.detail;r.layer=this,e==b&&this.setStyleGroup(r.feature),this._l.trigger(e,t,!0);},E.prototype.dispatchEvent=function(t,e){e.layer=this;e=new CustomEvent(t,{detail:e});this._l.trigger(t,e,!0);},E.prototype.setFeatureCoordinates=function(t,e){return this._fp.setFeatureCoordinates(t,e)},E.prototype.addFeature=function(t,e){var r=this._fp;if(r.addFeature){t=r.addFeature(t);return e&&this.setStyleGroup(t,e),t}},E.prototype.removeFeature=function(t){var e=this._fp;if(e.removeFeature)return e.removeFeature(t)},E.prototype.setStyleGroup=function(t,e,r){this._sd&&this.dispatchEvent(T,{feature:t,styleGroup:this._sd.setStyleGroup(t,e,r)});},E.prototype.getStyleGroup=function(t,e,r){return this._sd&&this._sd.getStyleGroup(t,e,r)},E.prototype.search=function(t,e){var r=this._fp;if(r&&r.search)return r.search.apply(this._fp,arguments)},E.prototype.getTile=function(t,e){var r=t.length,r=this._p[r];if(r)return r.getTile(t,e)},E.prototype.cancelTile=function(t,e){var r=("string"==typeof t?t:t.quadkey).length,r=this._p[r];if(r&&r.cancel)return r.cancel(t,e)},E.prototype.getCachedTile=function(t){var e=t.length,e=this._p[e];if(e)return e.getCachedTile(t)},E.prototype.setStyle=function(t,e){void 0===e&&(e=!1);function r(t){return "function"==typeof t}r(t.getStyleGroup)&&r(t.setStyleGroup)||(t=new m(t,e&&this._sd&&this._sd._c)),this._sd=t,this.dispatchEvent(M,{style:t});},E.prototype.getStyle=function(){return this._sd},E.prototype.getMargin=function(){return this.margin},E.prototype.setMargin=function(t){void 0===t&&(t=0),t=Number(t);for(var e=this._p,r=e.length;r--;)e[r]&&e[r].setMargin(t);return this.margin=t},E.prototype.pointerEvents=function(t){return t!=_&&(this._pev=!!t),this._pev},E.prototype.getCopyright=function(e){for(var t,r=this._p.filter(function(t,e,r){return r.indexOf(t)===e}),o=[],n=0,i=function(t){t.length&&o.push.apply(o,t),--n||e&&e(o);};t=r.pop();)t&&t.getCopyright&&(n++,t.getCopyright(i));},E);function E(t){this._p=[],this._sd=null,this._pev=!0,this.__type="Layer",this.margin=20,this.name="",this.min=15,this.max=32,this.levelOffset=0;var e,n=this,r=t.pointerEvents;for(e in delete t.pointerEvents,t)n[e]=t[e];n.id==_&&(n.id="L-"+(1e8*Math.random()^0)),n._l=new y.Listener([L,b,w,P,T,"viewportReady",M]),"boolean"==typeof r&&this.pointerEvents(r);function o(t,e,r){for(var o=t;o<=e;o++)n._p[o]=r;}var i=t.providers||t.provider,a=256;if(i instanceof Array)for(var s=0,l=i;s<l.length;s++){var p=l[s];o(p.min,p.max,p.provider);}else {var a=this.tileSize?i.size=this.tileSize:Math.max(a,i.size),u=Number(512==a),r=n.min-u,u=n.max-u;o(r,u,i),(n._fp=i).minLevel=r,i.maxLevel=u;}this.tileSize||a%256||(this.tileSize=a),this.levelOffset=Math.round(Math.log(this.tileSize)/Math.log(2)-8),n._p.forEach(function(t,e){t&&("FeatureProvider"==t.__type&&(t.addEventListener(L,n._eventProxy,n),t.addEventListener(b,n._eventProxy,n),t.addEventListener(w,n._eventProxy,n)),t.addEventListener(P,n._eventProxy,n));}),n.setMargin(n.getMargin());a=this._fp&&this._fp.styles;(a=t.style||t.styles||a||f)&&n.setStyle(a),["style","styles","provider","providers"].forEach(function(t){delete n[t];});}S.prototype.modifyFeatureCoordinates=S.prototype.setFeatureCoordinates;var O=(F.prototype.send=function(t){var o=t.success,e=t.error,n=t.responseType||this.responseType,r=t.headers,i=new XMLHttpRequest,a=t.withCredentials;if(i.withCredentials=null!=a?a:this.withCredentials,i.responseType="json"==n?"text":n,i.onload=function(){var t,e,r=this.responseType;""==r||"text"==r?(e=(t=this.responseText).length,"json"==n&&204!=this.status&&(t=JSON.parse(t))):e=(t=this.response).byteLength,200<=this.status&&this.status<=226&&o(t,e);},i.onreadystatechange=function(){4==this.readyState&&(this.status<200||300<=this.status)&&(this.onload=null,0!==this.status&&e&&e(this));},i.open(t.type||"GET",t.url,!0),r)for(var s in r)i.setRequestHeader(s,r[s]);return i.send(t.data||null),i},F);function F(t){for(var e in this.withCredentials=!1,this.responseType="",t)this[e]=t[e];}var U={},B=/{([xX]|(COL))}/,C=/{([yY]|(ROW))}/,k=/{([zZ]|(LEVEL))}/,z=/{((qk)|(QK)|(quadkey)|(QUADKEY))}/,R=/{SUBDOMAIN_INT_1_4}/,q=/{SUBDOMAIN_INT}/,D=/{SUBDOMAIN_CHAR}/,Y=function(t){this.name="NetworkError";var e=t.responseType;this.message="Service request failed with HTTP status: '"+t.status+" "+t.statusText+"'",this.statusCode=t.status,""!=e&&"text"!=e||(this.responseText=t.responseText||null);},X=(I.prototype.getUrl=function(t){var e=4*Math.random()^0;return this.baseUrl.replace(R,1+e).replace(q,e).replace(D,"abcd"[e]).replace(z,t.quadkey).replace(k,t.z).replace(B,t.x).replace(C,t.y)},I.prototype.setUrl=function(t){this.baseUrl=t;},I.prototype.load=function(t,r,e){var o,n=this.getUrl(t),i=t.quadkey,a=this.q,e={key:i,url:n,success:r,error:e};"image"==t.type?(e.responseType="blob",e.success=function(t){a[i]=o;var e=new Image;e.onload=function(t){delete a[i],y.global.URL.revokeObjectURL(e.src),o._aborted||r(e);},e.src=y.global.URL.createObjectURL(t);}):("json"==t.type&&(e.success=function(t,e){r("FeatureCollection"==t.type?t.features:t,e);}),e.headers=this.headers),o=this.send(e);},I.prototype.abort=function(t){var e=this.q,r=t.quadkey,o=e[r];o&&("image"==t.type&&(o.onload=void 0,o._aborted=!0),o.abort&&o.abort(),delete e[r]);},I.prototype.send=function(t){var r=t.key||Math.random(),o=this.q,n=t.success;t.success=function(t,e){delete o[r],n(t,e);};var e=t.error;return t.error=function(t){delete o[r],e&&e(new Y(t));},o[r]=this.http.send(t)},I);function I(t){this.withCredentials=!1,this.headers=null,this.store=null,this.baseUrl=null,this.q={};var e=t.responseType||"json",r=t.src||t.url,o=!!t.withCredentials;this.withCredentials=o,this.baseUrl=r,this.headers=y.JSUtils.extend(y.JSUtils.clone(U),t.headers||{}),"function"==typeof r&&(this.getUrl=function(t){return r(t.z,t.y,t.x,t.quadkey)}),this.http=new O({responseType:e,withCredentials:o});}var j,A=(n(G,j=X),G.prototype.receiveMessage=function(t){var e=t.data,r=e.msg;if("success"===r){t=e.url,r=this.cbs.get(t);if(r){this.cbs.delete(t),r.tile;var o,n=new a.XYZBin(e.triangles),i=n.getLayers();for(o in i)n.getFeatures(i[o]);r.success({mvt:e.data,xyz:i});}}},G.prototype.load=function(t,e,r){var o=this.getUrl(t);this.cbs.set(o,{tile:t,success:e,error:r}),this.worker.postMessage({msg:"load",url:o,x:t.x,y:t.y,z:t.z});},G.prototype.abort=function(t){t=this.getUrl(t);this.cbs.get(t)&&(this.cbs.delete(t),this.worker.postMessage({msg:"abort",url:t}));},G);function G(t){t=j.call(this,t)||this;return t.cbs=new Map,t.worker=new Worker(window.here.xyz.maps.__workerURL),t.worker.addEventListener("message",t.receiveMessage.bind(t)),t}var N=(J.prototype.toJSON=function(){return y.JSUtils.clone({id:this.id,type:this.type,bbox:this.bbox,properties:this.properties,geometry:{type:this.geometry.type,coordinates:this.geometry.coordinates}})},J.prototype.getProvider=function(){return this._provider},J.prototype.getBBox=function(){return this._provider.decBBox(this)},J);function J(t,e){this._m=0,this.id=t.id,this.properties=t.properties,this.geometry=t.geometry,this.bbox=t.bbox,this._provider=e;}N.prototype.type="Feature";var Q,H=a.vectorTile.VectorTile,V=a.vectorTile.VectorTileFeature;V.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r,o=t.readVarint()+t.pos,n=1,i=0,a=0,s=0,l=[];t.pos<o;)if(i<=0&&(n=7&(r=t.readVarint()),i=r>>3),i--,1===n||2===n)a+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push([a,s]);else {if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].slice());}return e&&l.push(e),l};var Z=y.TaskManager.getInstance(),K=16,W=0;function $(t){var e=t.length;if(e<=1)return [t];for(var r,o,n=[],i=0;i<e;i++){var a=function(t){for(var e,r,o=0,n=0,i=t.length,a=i-1;n<i;a=n++)e=t[n],r=t[a],o+=(r[0]-e[0])*(e[1]+r[1]);return o}(t[i]);0!==a&&((o=void 0===o?a<0:o)===a<0?(r&&n.push(r),r=[t[i]]):r.push(t[i]));}return r&&n.push(r),n}var tt=function(t,e){return 360*t/e-180},et=function(t,e){return 360/Math.PI*Math.atan(Math.exp((180-360*t/e)*Math.PI/180))-90},rt=function(t,e,r,o,n){var i=t.loadGeometry();switch(t.type){case 1:for(var a=[],s=0;s<i.length;s++)a[s]=i[s][0];n(i=a,e,r,o,t);break;case 2:for(s=0;s<i.length;s++)n(i[s],e,r,o,t);break;case 3:for(i=$(i),s=0;s<i.length;s++)for(var l=0;l<i[s].length;l++)n(i[s][l],e,r,o,t);}return i},ot=function(t,e,r,o){var i=1/0,a=-i,s=i,l=-s,n=t.extent*(1<<o),p=t.extent*e,u=t.extent*r,h=V.types[t.type];return 1<rt(t,e,r,o,function(t){for(var e=0,r=t;e<r.length;e++){var o=r[e],n=o[0],o=o[1];n<i&&(i=n),a<n&&(a=n),o<s&&(s=o),l<o&&(l=o);}}).length&&(h="Multi"+h),{bbox:[tt(i+p,n),et(l+u,n),tt(a+p,n),et(s+u,n)],type:h}};function nt(t,e,r,o,n){for(var i=n.extent,a=1<<o,s=0,l=t;s<l.length;s++){var p=l[s];p[0]=(e+p[0]/i)/a,p[1]=(r+p[1]/i)/a;}}var it=(at.prototype._coordinates=function(){var t=this.type,e=this.__xyz,r=e.x,o=e.y,e=e.z,e=rt(this._vtf,r,o,e,nt);return e="Point"==t||"Polygon"==t||"LineString"==t?e[0]:e},Object.defineProperty(at.prototype,"coordinates",{get:function(){var n,i,a,t=this.__xyz,e=t.x,r=t.y,o=t.z;return t=this._vtf,o=o,n=t.extent*(1<<o),i=t.extent*e,a=t.extent*r,o=1===(o=rt(t,e,r,o,function(t){for(var e=0;e<t.length;e++){var r=t[e],o=tt(r[0]+i,n),r=et(r[1]+a,n);t[e]=[o,r];}})).length?o[0]:o},enumerable:!1,configurable:!0}),at);function at(t,e,r){this.type=t,this._vtf=e,this.__xyz=r;}function st(n){Z.create({init:function(){var t,e=[],r=new H(new a.pbf(n.data.mvt)),o=n.tile;for(t in r.layers)e.push(t);return {xyz:{x:o.x,y:o.y,z:o.z},mvt:r,xyzLayers:n.data.xyz,layers:e,l:0,f:0,geojson:[]}},priority:4,exec:function(t){for(var e,r,o,n,i,a,s=t.mvt,l=t.xyz,p=t.layers,u=t.xyzLayers,h=t.l,c=t.f,d=t.geojson;h<p.length;){for(e=s.layers[p[h]],r={x:l.x,y:l.y,z:l.z,l:e.name};c<e.length;)if(o=e.feature(c),i=!0,a=void 0,a=ot(o,(n=r).x,n.y,n.z),n={type:"Feature",geometry:new it(a.type,o,n),properties:o.properties},"id"in o&&(n.id=o.id),i&&(n.bbox=a.bbox),"MultiPolygon"!=(n=(a=n).geometry.type)&&"Polygon"!=n||(n=u[h]&&u[h].features[c])&&(a.geometry._xyz=n),a.id=++W,c++,a.properties.layer==Q&&(a.properties.layer=e.name),d.push(a),!(c%K))return t.f=c,this.CONTINUE;return t.l=++h,t.f=0,this.CONTINUE}return this.BREAK},onDone:function(t){n.ready(t.geojson);}}).start();}function lt(t,e){return (t+180)/360*e}function pt(t,e){return (180-180/gt*Math.log(Math.tan(gt/4+t*gt/360)))*e/360}function ut(t,e){return 360*t/e-180}function ht(t,e){return 360/gt*Math.atan(Math.exp((180-360*t/e)*gt/180))-90}function ct(t,e,r){var o=1<<r;return [_t.floor(xt.lon2x(t,o)),_t.floor(xt.lat2y(e,o)),r]}function dt(t){for(var e=(t="number"==typeof t?String(t):t).length,r=0,o=0,n=0;n<e;++n)switch(r*=2,o*=2,t[n]){case"1":o++;break;case"3":o++;case"2":r++;}return [e,r,o]}function ft(t,e,r){for(var o,n="";0<t--;)n+=(0!=(r&(o=1<<t)))+2*(0!=(e&o));return n}function yt(t,e,r){return e*=256,[xt.x2lon(r*=256,t=256<<t),xt.y2lat(256+e,t),xt.x2lon(256+r,t),xt.y2lat(e,t)]}function vt(t,e){for(var r=[],o=e[1]-t[1]+1,n=e[0]-t[0]+1,i=t[2],a=0;a<o;a++)for(var s=0;s<n;s++)r[r.length]=ft(i,t[1]+a,t[0]+s);return r}var gt=Math.PI,mt=Array.from({length:33},function(t,e){return 40075017/256/(1<<e)}),xt={mapSizePixel:function(t,e){return Math.pow(2,e)*t},lon2x:lt,lat2y:pt,x2lon:ut,y2lat:ht,pixelToGeo:function(t,e,r){return {longitude:ut(t,r),latitude:ht(e,r)}},geoToPixel:function(t,e,r){return {x:lt(t,r),y:pt(e,r)}},meterToPixel:function(t,e){return t/mt[e]},pixelToMeter:function(t,e){return t*mt[e]},getGroundResolution:function(t){return mt[t]}},_t=y.global.Math,bt=85.05112878,Lt=-bt,wt={geoToGrid:ct,pixelToGrid:function(t,e,r){return [_t.floor(t),_t.floor(e),r]},quadToGrid:dt,tileXYToQuadKey:ft,getGeoBounds:yt,getTilesOfLevel:function(t,e){var r=[t],o=0,n=r.length,i=t.length;if(e<=i)return [t.substring(0,e)];for(;i<e;){for(;o<n;o++)r.push(r[o]+"0",r[o]+"1",r[o]+"2",r[o]+"3");o=n,n=r.length,i++;}return r.slice(o)},getTilesIds:vt,getTilesInRect:function(t,e,r,o,n){180<=r&&(r=180-1e-6),e<Lt&&(e=1e-6+Lt);o=ct(t=t<=-180?-180:t,o=bt<=o?bt-1e-6:o,n),n=ct(r,e,n);return vt(o,n)}};var Tt,Mt,Pt,St=(function(t){function d(t,e,r){var o=t[e];t[e]=t[r],t[r]=o;}function l(t,e){return t<e?-1:e<t?1:0}function f(t,e){y(t,0,t.children.length,e,t);}function y(t,e,r,o,n){(n=n||m(null)).minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var i=e;i<r;i++){var a=t.children[i];c(n,t.leaf?o(a):a);}return n}function c(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function i(t,e){return t.minX-e.minX}function a(t,e){return t.minY-e.minY}function v(t){return (t.maxX-t.minX)*(t.maxY-t.minY)}function g(t){return t.maxX-t.minX+(t.maxY-t.minY)}function u(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return {children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function x(t,e,r,o,n){for(var i,a,s=[e,r];s.length;)(r=s.pop())-(e=s.pop())<=o||(i=e+Math.ceil((r-e)/o/2)*o,function t(e,r,o,n,i){for(;o<n;){var a,s,l,p;600<n-o&&(a=n-o+1,s=r-o+1,p=Math.log(a),l=.5*Math.exp(2*p/3),p=.5*Math.sqrt(p*l*(a-l)/a)*(s-a/2<0?-1:1),t(e,r,Math.max(o,Math.floor(r-s*l/a+p)),Math.min(n,Math.floor(r+(a-s)*l/a+p)),i));var u=e[r],h=o,c=n;for(d(e,o,r),0<i(e[n],u)&&d(e,o,n);h<c;){for(d(e,h,c),h++,c--;i(e[h],u)<0;)h++;for(;0<i(e[c],u);)c--;}0===i(e[o],u)?d(e,o,c):d(e,++c,n),c<=r&&(o=c+1),r<=c&&(n=c-1);}}(a=t,i,e||0,r||a.length-1,n||l),s.push(e,i,i,r));}t.exports=((t=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear();}).prototype.all=function(){return this._all(this.data,[])},t.prototype.search=function(t){var e=this.data,r=[];if(!p(t,e))return r;for(var o=this.toBBox,n=[];e;){for(var i=0;i<e.children.length;i++){var a=e.children[i],s=e.leaf?o(a):a;p(t,s)&&(e.leaf?r.push(a):u(t,s)?this._all(a,r):n.push(a));}e=n.pop();}return r},t.prototype.collides=function(t){var e=this.data;if(!p(t,e))return !1;for(var r=[];e;){for(var o=0;o<e.children.length;o++){var n=e.children[o],i=e.leaf?this.toBBox(n):n;if(p(t,i)){if(e.leaf||u(t,i))return !0;r.push(n);}}e=r.pop();}return !1},t.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r,o=this._build(t.slice(),0,t.length-1,0);return this.data.children.length?this.data.height===o.height?this._splitRoot(this.data,o):(this.data.height<o.height&&(r=this.data,this.data=o,o=r),this._insert(o,this.data.height-o.height-1,!0)):this.data=o,this},t.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},t.prototype.clear=function(){return this.data=m([]),this},t.prototype.remove=function(t,e){if(!t)return this;for(var r,o,n,i=this.data,a=this.toBBox(t),s=[],l=[];i||s.length;){if(i||(i=s.pop(),o=s[s.length-1],r=l.pop(),n=!0),i.leaf){var p=function(t,e,r){if(!r)return e.indexOf(t);for(var o=0;o<e.length;o++)if(r(t,e[o]))return o;return -1}(t,i.children,e);if(-1!==p)return i.children.splice(p,1),s.push(i),this._condense(s),this}n||i.leaf||!u(i,a)?o?(r++,i=o.children[r],n=!1):i=null:(s.push(i),l.push(r),i=(o=i).children[r=0]);}return this},t.prototype.toBBox=function(t){return t},t.prototype.compareMinX=function(t,e){return t.minX-e.minX},t.prototype.compareMinY=function(t,e){return t.minY-e.minY},t.prototype.toJSON=function(){return this.data},t.prototype.fromJSON=function(t){return this.data=t,this},t.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},t.prototype._build=function(t,e,r,o){var n,i=r-e+1,a=this._maxEntries;if(i<=a)return f(n=m(t.slice(e,r+1)),this.toBBox),n;o||(o=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,o-1))),(n=m([])).leaf=!1,n.height=o;var s=Math.ceil(i/a),l=s*Math.ceil(Math.sqrt(a));x(t,e,r,l,this.compareMinX);for(var p=e;p<=r;p+=l){var u=Math.min(p+l-1,r);x(t,p,u,s,this.compareMinY);for(var h=p;h<=u;h+=s){var c=Math.min(h+s-1,u);n.children.push(this._build(t,h,c,o-1));}}return f(n,this.toBBox),n},t.prototype._chooseSubtree=function(t,e,r,o){for(;o.push(e),!e.leaf&&o.length-1!==r;){for(var n=1/0,i=1/0,a=void 0,s=0;s<e.children.length;s++){var l=e.children[s],p=v(l),u=(u=t,h=l,(Math.max(h.maxX,u.maxX)-Math.min(h.minX,u.minX))*(Math.max(h.maxY,u.maxY)-Math.min(h.minY,u.minY))-p);u<i?(i=u,n=p<n?p:n,a=l):u===i&&p<n&&(n=p,a=l);}e=a||e.children[0];}var u,h;return e},t.prototype._insert=function(t,e,r){var o=r?t:this.toBBox(t),n=[],r=this._chooseSubtree(o,this.data,e,n);for(r.children.push(t),c(r,o);0<=e&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(o,n,e);},t.prototype._split=function(t,e){var r=t[e],o=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,o);o=this._chooseSplitIndex(r,n,o),o=m(r.children.splice(o,r.children.length-o));o.height=r.height,o.leaf=r.leaf,f(r,this.toBBox),f(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(r,o);},t.prototype._splitRoot=function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,f(this.data,this.toBBox);},t.prototype._chooseSplitIndex=function(t,e,r){for(var o,n,i,a,s,l,p=1/0,u=1/0,h=e;h<=r-e;h++){var c=y(t,0,h,this.toBBox),d=y(t,h,r,this.toBBox),f=(n=c,i=d,0,a=Math.max(n.minX,i.minX),f=Math.max(n.minY,i.minY),s=Math.min(n.maxX,i.maxX),l=Math.min(n.maxY,i.maxY),Math.max(0,s-a)*Math.max(0,l-f)),d=v(c)+v(d);f<p?(p=f,o=h,u=d<u?d:u):f===p&&d<u&&(u=d,o=h);}return o||r-e},t.prototype._chooseSplitAxis=function(t,e,r){var o=t.leaf?this.compareMinX:i,n=t.leaf?this.compareMinY:a;this._allDistMargin(t,e,r,o)<this._allDistMargin(t,e,r,n)&&t.children.sort(o);},t.prototype._allDistMargin=function(t,e,r,o){t.children.sort(o);for(var n=this.toBBox,i=y(t,0,e,n),a=y(t,r-e,r,n),s=g(i)+g(a),l=e;l<r-e;l++){var p=t.children[l];c(i,t.leaf?n(p):p),s+=g(i);}for(var u=r-e-1;e<=u;u--){var h=t.children[u];c(a,t.leaf?n(h):h),s+=g(a);}return s},t.prototype._adjustParentBBoxes=function(t,e,r){for(var o=r;0<=o;o--)c(e[o],t);},t.prototype._condense=function(t){for(var e=t.length-1,r=void 0;0<=e;e--)0===t[e].children.length?0<e?(r=t[e-1].children).splice(r.indexOf(t[e]),1):this.clear():f(t[e],this.toBBox);},t);}(Mt={path:Tt,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&Mt.path)}},Mt.exports),Mt.exports),Et=(n(Ot,Pt=St),Ot.prototype.toBBox=function(t){t=t.bbox;return {minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},Ot.prototype.compareMinX=function(t,e){return t.bbox[0]-e.bbox[0]},Ot.prototype.compareMinY=function(t,e){return t.bbox[1]-e.bbox[1]},Ot);function Ot(t){return Pt.call(this,t)||this}var Ft=null,Ut=(Bt.prototype.expired=function(t){return (t=t||Date.now())-this.loadStopTs>1e3*this.expire},Bt.prototype.add=function(t){var e=this.data;e&&-1==e.indexOf(t)&&(e.push(t),this.tree&&this.tree.insert(t));},Bt.prototype.remove=function(t){var e=this.data.indexOf(t);-1!==e&&(this.data.splice(e,1),this.tree&&this.tree.remove(t));},Bt.prototype.search=function(t){if(this.data)return this.tree||(this.tree=new Et(9),this.tree.load(this.data)),this.tree.search(t)},Bt.prototype.isLoaded=function(){return "number"==typeof this.loadStopTs},Bt.prototype.getContentBounds=function(){var t,e,r,o,n;return this.cbnds||(n=this.bounds,(t=(o=this.provider).margin)?(r=(e=o.size)<<this.z,o=xt.lon2x(n[0],r),n=xt.lat2y(n[1],r),this.cbnds=[xt.x2lon(o-t,r),xt.y2lat(n+t,r),xt.x2lon(o+t+e,r),xt.y2lat(n-t-e,r)]):this.cbnds=this.bounds),this.cbnds},Bt.prototype.project=function(t,e){var r=256<<this.z,o=256*this.x,n=256*this.y;return [Math.round(xt.lon2x(t,r)-o),Math.round(xt.lat2y(e,r)-n)]},Bt.prototype.lon2x=function(t,e){var r=(e=void 0===e?256:e)<<this.z,e=this.x*e;return xt.lon2x(t,r)-e},Bt.prototype.lat2y=function(t,e){var r=(e=void 0===e?256:e)<<this.z,e=this.y*e;return xt.lat2y(t,r)-e},Bt.prototype.isInside=function(t){var e=this.bounds,r=t[0],t=t[1];return r>e[0]&&r<=e[2]&&t>e[1]&&t<=e[3]},Bt);function Bt(t,e,r,o){var n=dt(t);this.quadkey=t,this.z=n[0],this.y=n[1],this.x=n[2],this.type=e,this.bounds=yt(n[0],n[1],n[2]),this.expire=o,this.clipped=r;}var Ct=Ut.prototype;Ct.expire=1/0,Ct.error=Ft,Ct.canvasX=Ft,Ct.canvasY=Ft;var kt,zt=(n(Rt,kt=Ut),Rt.prototype.lon2x=function(t,e){return void 0===e&&(e=256),Math.round((t*this.s-this.x)*e)},Rt.prototype.lat2y=function(t,e){return void 0===e&&(e=256),Math.round((t*this.s-this.y)*e)},Rt.prototype.isInside=function(t){var e=t[0]*this.s-this.x,t=t[1]*this.s-this.y;return !(e<0||1<e||t<0||1<t)},Rt);function Rt(t,e,r,o){o=kt.call(this,t,e,r,o)||this;return o.s=1<<o.z,o}var qt=(Dt.prototype.forEach=function(t){this.main.forEach(t),this.sub.forEach(t);},Dt.prototype.clear=function(){this.main.clear(),this.sub.clear();},Dt.prototype.getCache=function(t){return t==this.lvl?this.main:this.sub},Dt.prototype.remove=function(t){this.getCache(t.z).remove(t.quadkey);},Dt.prototype.get=function(t){return this.getCache(t.length).get(t)},Dt.prototype.set=function(t){var e=this.getCache(t.z).set(t.quadkey,t),t=this._onDrop;e&&t&&t(e);},Dt.prototype.onDrop=function(t){this._onDrop=t;},Dt);function Dt(t,e,r){this.lvl=t,this.main="object"==typeof e?e:new y.LRU(e||256),this.sub="object"==typeof r?r:new y.LRU(e||1024);}var Yt=(Xt.prototype.dispatchEvent=function(t,e){e.provider=this;e=new CustomEvent(t,{detail:e});this.listeners.trigger(t,e,!0);},Xt.prototype.initStorage=function(t){t.onDrop(function(t){return t.provider._removeTile(t)});},Xt.prototype.addEventListener=function(t,e,r){return this.listeners.add(t,e,r)},Xt.prototype.removeEventListener=function(t,e,r){return this.listeners.remove(t,e,r)},Xt.prototype.clear=function(t){this.storage.clear();},Xt.prototype.getCachedTile=function(t){return this.storage.get(t)},Xt.prototype.setMargin=function(t){void 0===t&&(t=0),this.margin=Number(t),this.storage.forEach(function(t){return t.cbnds=null});},Xt.prototype.getCachedTilesOfBBox=function(t,l){var p=t[0],u=t[1],h=t[2],c=t[3],d=[];return l^=0,this.storage.forEach(function(t){var e,r,o,n,i,a,s=t.getContentBounds();e=s[0],r=s[2],o=s[1],n=s[3],i=p,a=u,s=c,e<=h&&i<=r&&o<=s&&a<=n&&(!l||t.z==l)&&(d[d.length]=t);}),d},Xt.prototype.config=function(t){for(var e in t=t||{})this.config[e]=t[e];return this},Xt.prototype.createTile=function(t){t=new this.Tile(t,this.dataType,this.clipped,this.expire);return t.provider=this,t},Xt);function Xt(t){this.margin=0,this.dep={},this.Tile=Ut,this.size=256,this.expire=1/0,this.clipped=!1;for(var e in t=t||{})this[e]=t[e];null==this.id&&(this.id="TP-"+(1e6*Math.random()^0)),this.storage=t.storage||new qt(this.level),this.initStorage(this.storage),this.listeners=new y.Listener(["clear","error"]);}Yt.prototype.__type="Provider";function It(t,e){var r;e&&((r=t[0])<e[0]&&(e[0]=r),r>e[2]&&(e[2]=r),(t=t[1])<e[1]&&(e[1]=t),t>e[3]&&(e[3]=t));}function jt(t,e){for(var r=t.length;r--;)It(t[r],e);}function At(t,e){var r=t.geometry.type,o=t.geometry.coordinates;if("Point"==r)e?It(o,e):e=[o[0],o[1],o[0],o[1]];else if(e=e||[1/0,1/0,-1/0,-1/0],"MultiLineString"==r)for(var n=0;n<o.length;n++)jt(o[n],e);else if("MultiPolygon"==r)for(var i=0;i<o.length;i++)jt(o[i][0],e);else if("LineString"==r||"MultiPoint"==r)jt(o,e);else {if("Polygon"!=r)return !1;jt(o[0],e);}return e}var Gt,Nt={calcBBox:At},Jt="featureRemove",Qt="featureAdd",Ht="featureCoordinatesChange";function Vt(t){this.feature=t;}Vt.prototype.cnt=0;var Zt,Kt=(n(Wt,Zt=Yt),Wt.prototype.isDroppable=function(t){return !0},Wt.prototype.addFeature=function(t){var e,r=this;if("object"==typeof t){if("FeatureCollection"==t.type&&(t=t.features||[]),Array.isArray(t)){for(var o=[],n=0,i=t.length;n<i;n++)o[n]=r.addFeature(t[n]);return o}if(!r.isFeatureInstance(t,N)||(e=t.getProvider())&&e!=r&&(t=t.toJSON()),!1!==(e=r.prepareFeature(t))){if((e=r._insert(e))!=Gt){for(var a=r.getCachedTilesOfBBox(r.decBBox(t=e)),s=0,l=void 0;s<a.length;s++)(l=a[s]).add(t),l.z==r.level&&this._mark(t,l);r.tree&&r.tree.insert(t),r.ignore||r.dispatchEvent(Qt,{feature:t,tiles:a});}}else t=null;return t}},Wt.prototype.addEventListener=function(t,e,r){return Zt.prototype.addEventListener.call(this,t,e,r)},Wt.prototype.removeEventListener=function(t,e,r){return Zt.prototype.removeEventListener.call(this,t,e,r)},Wt.prototype.all=function(){return this.tree?this.tree.all():this._s({minX:-180,maxX:180,minY:-90,maxY:90})},Wt.prototype.getFeature=function(t){if(this.IDPOOL[t])return this.IDPOOL[t].feature},Wt.prototype.getFeatures=function(t){t instanceof Array||(t=[t]);for(var e=[],r=0;r<t.length;r++)e[r]=this.getFeature(t[r]);return 1==e.length?e[0]:e},Wt.prototype.getTile=function(t,e){var r=this.storage,o=r.get(t);return o===Gt&&(r.set(o=this.createTile(t)),o.loadStartTs=o.loadStopTs=Date.now(),o.data=this.search(o.getContentBounds())),e&&e(o),o},Wt.prototype.setFilter=function(t){this.filter="function"==typeof t?t:Gt;},Wt.prototype.getFeatureClass=function(t){return this.Feature},Wt.prototype.isFeatureInstance=function(t,e){return t instanceof e},Wt.prototype.createFeature=function(t,e){return new e(t,this)},Wt.prototype.search=function(t,e){if("object"==typeof t)if(e)for(var r in t)e[r]=t[r];else e=t;var o=e&&e.radius||1;if(t instanceof Array)n=4==t.length?t:y.geotools.getPointBBox(t,o);else {if("number"==typeof t||"string"==typeof t||!t)return this.getFeatures(t);if(t.longitude!=Gt&&t.latitude!=Gt)n=y.geotools.getPointBBox([t.longitude,t.latitude],o);else if(t.minLon!=Gt&&t.minLat!=Gt&&t.maxLon!=Gt&&t.maxLat!=Gt)n=[t.minLon,t.minLat,t.maxLon,t.maxLat];else {if(o=t.point||t.rect||t.viewport)return this.search(o,e);if(t.id||t.ids)return this.getFeatures(t.id||t.ids)}}var n={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]};return this._s(n)},Wt.prototype.exists=function(t){return this.IDPOOL[t.id]},Wt.prototype.setFeatureCoordinates=function(t,e){var r,o,n,i=t;(t=this.getFeature(t.id))?(r=t.getBBox(),n=(o=t.geometry).coordinates,this.ignore=!0,this.removeFeature(t),o._xyz&&delete o._xyz,o.coordinates=this.encCoord(o.type,e),t.bbox=null,this.addFeature(t),this.ignore=!1,this.dispatchEvent(Ht,{feature:t,prevBBox:r,prevCoordinates:n,provider:this})):(i.geometry.coordinates=e,i.bbox=null,this.updateBBox(i));},Wt.prototype.removeFeature=function(t){if(t){if("FeatureCollection"==t.type&&(t=t.features),Array.isArray(t)){for(var e=[],r=0,o=t.length;r<o;r++)e[r]=this.removeFeature(t[r]);return e}if(t=this.getFeature(t.id)){for(var n=this.getCachedTilesOfBBox(this.decBBox(t)),i=void 0,a=0;a<n.length;a++)(i=n[a]).isLoaded()&&i.remove(t);this.cnt--,delete this.IDPOOL[t.id],this.tree&&this.tree.remove(t),this.ignore||this.dispatchEvent(Jt,{feature:t,tiles:n});}}return t},Wt.prototype.clear=function(t){var e,r=this,o=null;if((t=4==arguments.length?Array.prototype.slice.call(arguments):t)instanceof Array)for(var n,o=r.getCachedTilesOfBBox(t,r.level),i=0;i<o.length;i++)n=o[i],r._removeTile(n,!1),o[i]=n.quadkey;else if(0==arguments.length){var a,s={},l=r.IDPOOL,p=0;for(a in r.tree&&r.tree.clear(),l)e=r.getFeature(a),r.isDroppable(e)||(s[a]=new Vt(e),p++,r.tree&&r.tree.insert(e));r.cnt=p,r.dep={},r.IDPOOL=s,Yt.prototype.clear.call(this,t);}r.dispatchEvent("clear",{tiles:o});},Wt.prototype._insert=function(t,e){var r=t.id,o=null,n=this.getFeatureClass(t),i=this.filter;return i&&!i(t)||(this.IDPOOL[r]===Gt&&(this.cnt++,this.isFeatureInstance(t,n)?t._provider=this:t=this.createFeature(t,n),this.updateBBox(t),this.IDPOOL[r]=new Vt(t),o=t),e&&this._mark(t,e)),o},Wt.prototype._mark=function(t,e){t=this.IDPOOL[t.id];t[e.quadkey]||(t.cnt++,t[e.quadkey]=!0);},Wt.prototype._removeTile=function(t,e){var r,o,n=this,i=t.quadkey;if(r=n.dep[i]){for(var a=0;a<r.length;a++)n.storage.remove(r[a]);delete n.dep[i];}if(n.storage.remove(t),o=t.data)for(a=0;a<o.length;a++)n._dropFeature(o[a],i,e);},Wt.prototype._dropFeature=function(t,e,r){var o=this,n=o.IDPOOL[t.id];n&&(n[e]&&(n[e]=Gt,n.cnt--),o.isDroppable(t)&&(n.cnt||(o.cnt--,delete o.IDPOOL[t.id],o.tree&&o.tree.remove(t),r&&o.dispatchEvent(Jt,{feature:t}))));},Wt.prototype._s=function(a){if(this.tree)return this.tree.search(a);var s,l,p=1e8*Math.random()^0,u=this.level;return this.storage.forEach(function(t){if(t.z==u&&t.isLoaded()&&(l=t.search(a)).length)if(s)for(var e=0,r=l;e<r.length;e++)(o=r[e])._m!=p&&(o._m=p,s[s.length]=o);else for(var o,n=0,i=s=l;n<i.length;n++)(o=i[n])._m=p;}),s||[]},Wt.prototype.encCoord=function(t,e){return e},Wt.prototype.decCoord=function(t){return t.geometry.coordinates},Wt.prototype.decBBox=function(t){return t.bbox},Wt.prototype.prepareFeature=function(t){return t.id==Gt&&(t.id=1e8*Math.random()^0),t.bbox?(6===t.bbox.length&&(t.bbox=[t.bbox[0],t.bbox[1],t.bbox[3],t.bbox[4]]),t):this.updateBBox(t)&&t},Wt.prototype.updateBBox=function(t){if(!t.bbox){var e=At(t);if(!e)return !1;t.bbox=e;}return !0},Wt);function Wt(t){var e=Zt.call(this,t)||this;return e.IDPOOL={},e.dataType="json",e.ignore=!1,e.cnt=0,e.__type="FeatureProvider",e.tree=new Et(9),e.Feature=e.Feature||N,[Qt,Jt,Ht].forEach(function(t){return e.listeners.addEvent(t)}),e}Kt.prototype.modifyFeatureCoordinates=Kt.prototype.setFeatureCoordinates;var $t=(te.prototype.exec=function(){for(var t=this.q;t.length&&this.executing<this.parallel;)this.fire(t.pop(),t.pop(),t.pop());},te.prototype.fire=function(r,o,e,t){var n=this,i=n.src,a=n.lq,t=0^t;n.executing++,a[r.quadkey]=[r,o,e,t],i[t].load(r,function(t,e){n.executing--,delete a[r.quadkey],n.exec(),o(t,e);},function(t){e(t),n.executing--,delete a[r.quadkey],n.exec();});},te.prototype.tile=function(t,e,r){this.q.push(r,e,t),this.exec();},te.prototype.abort=function(t){var e,r=this,o=r.q,n=r.lq,i=r.src,a=!0;return -1!==(e=o.indexOf(t))?o.splice(e-2,3):(e=n[t.quadkey])?(r.executing--,delete n[t.quadkey],i[e[3]].abort(t)):a=!1,r.exec(),a},te.prototype.store=function(t,e){var r,o=this.src;for(r in o)if(o[r].store){o[r].store(t,e);break}},te.prototype.clear=function(){this.src.forEach(function(t){t.clear&&t.clear();});},te.prototype.setUrl=function(){var t,e=this.src;for(t in e)e[t].setUrl&&e[t].setUrl.apply(e[t],arguments);},te);function te(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.executing=0,this.parallel=16,this.q=[],this.lq={},this.src=t;}var ee=(re.prototype.receive=function(t){var e,r,o,n=this;n.ready||(e=n.tile,-1!=(o=(r=n.qks).indexOf(t.quadkey))&&(r[o]=null,++n.c==r.length&&(n.ready=!0,e.processedData=void 0,(t=t.error)?e.error=t:e.data=e.provider.search(e.getContentBounds()),e.loadStopTs=Date.now(),n.exec(),e.onLoaded.length=0,n.qks=null)));},re.prototype.exec=function(){for(var t=this.cbs,e=t.length,r=this.tile,o=0;o<e;)t[o++](r,r.error);t.length=0;},re.prototype.add=function(t){var e=this.cbs;if("function"==typeof t&&-1==e.indexOf(t))return e.push(t),!0},re.prototype.remove=function(t){var e=this.cbs,t=e.indexOf(t);return -1!=t&&e.splice(t,1),e.length},re);function re(t,e){this.c=0,this.cbs=[],this.qks=e,this.tile=t;}ee.prototype.ready=!1;function oe(o){return function(t,e,r){t={data:t,provider:this,ready:e};r&&(t.tile={x:r.x,y:r.y,z:r.z}),e=o,t=(r=void 0===(r=t)?{}:r).ready,e=se(e)?e(r):r.data,!(r=e)||"object"!=typeof r&&"function"!=typeof r||"function"!=typeof r.then?void 0!==e&&t(e):e.then(t);}}var ne,ie,ae=function(t){return "function"==typeof t},se=ae,le=ae,pe=(n(ue,ie=Kt),ue.prototype.cancel=function(t,e){var r=this.storage,o=e==ne,n=t instanceof this.Tile?t:r.get(t);if(n){t=n.quadkey;for(var i,a,s=this.calcStorageQuads(t),l=0,p=void 0,u=void 0;l<s.length;l++)(p=(u=s[l])==t?n:r.get(u))&&(a=void 0,(i=p.onLoaded)&&(o?n.onLoaded.length=0:this.level&&n.z!=this.level?-1!=(a=i.indexOf(n.onLoaded[0]))&&(i[a].remove(e)||i.splice(a,1)):i.splice(i.indexOf(e),1),i.length||this.loader.abort(p)&&r.remove(p)));}},ue.prototype.getLoader=function(){return this.loader},ue.prototype.config=function(t){return ie.prototype.config.call(this,t)},ue.prototype.clear=function(t){0==arguments.length&&this.loader.clear(),ie.prototype.clear.apply(this,arguments);},ue.prototype.calcStorageQuads=function(t){return wt.getTilesOfLevel(t,this.level)},ue.prototype.createTile=function(t){var e,r,o=ie.prototype.createTile.call(this,t),n=o.z,i=this.level;if(i&&n!=i)if(i<n)e=t.substr(0,i),(r=(r=this.dep[e])||(this.dep[e]=[]))[r.length]=o;else if(n<i)for(var a=wt.getTilesOfLevel(t,i),s=0,l=a.length;s<l;s++)e=a[s],(r=(r=this.dep[e])||(this.dep[e]=[]))[r.length]=o;return o},ue.prototype.execTile=function(t){var e,r=t.onLoaded;if(r){for(var o=0,n=r.length;o<n;o++)(e=r[o])instanceof ee?e.receive(t):e(t);r.length=0;}},ue.prototype.attachData=function(t,e){for(var r,o,n=this,i=[],a=e.length,s=0;s<a;s++)!1!==(r=n.prepareFeature(o=e[s]))?(r=n._insert(o=r,t))?i[i.length]=o=r:n.tree||(i[i.length]=n.getFeature(o.id)):(e.splice(s--,1),a--);if(e=i,t.loadStopTs=Date.now(),n.tree&&n.tree.load(e),t.data=n.clipped?e:n.search(t.getContentBounds()),n.margin)for(var l=0,p=t.data.length;l<p;l++)n._mark(t.data[l],t);n.execTile(t);},ue.prototype.getTile=function(t,e){var r,o=this,n=o.storage,i=o.level;if((r=n.get(t))==ne)(r=o.createTile(t)).onLoaded=[],r.data=[],n.set(r);else if(r.isLoaded())return e&&e(r,r.error),r;if(t.length!=i){var a=o.calcStorageQuads(t),s=void 0,l=void 0;r.loadStartTs=Date.now(),r.onLoaded.length?l=r.onLoaded[0]:(l=new ee(r,a),r.onLoaded.push(l)),l.add(e);for(var p=0;p<a.length;p++)(s=n.get(a[p]))==ne?s=o.getTile(a[p],l):s.isLoaded()?l.receive(s):-1==s.onLoaded.indexOf(l)&&s.onLoaded.push(l);}else e&&-1==r.onLoaded.indexOf(e)&&r.onLoaded.push(e),r.loadStartTs||(r.loadStartTs=Date.now(),o.loader.tile(r,function(t,e){o.sizeKB+=e/1024,o.preprocess(t,function(t){return o.attachData(r,t)},r);},function(t){r.loadStopTs=Date.now(),r.error=t,o.execTile(r),o.listeners.trigger("error",[t],!0);}));return r},ue.prototype._removeTile=function(t,e){ie.prototype._removeTile.call(this,t,e),t.isLoaded()||this.loader.abort(t);},ue);function ue(t){var e=ie.call(this,d({minLevel:8,maxLevel:20,staticData:!1},t))||this;e.sizeKB=0;var r=e,o=t.loader;if(!o)throw new Error("no tile loader defined.");o instanceof $t||(o=new $t(o)),r.loader=o;t=t.preProcessor;return r.preprocess=oe(t),e}var he,ce=(n(de,he=N),de.prototype.getMvtLayer=function(){return this.geometry.__xyz.l},de);function de(){return null!==he&&he.apply(this,arguments)||this}var fe,ye=(n(ve,fe=pe),ve.prototype.decCoord=function(t){return t.geometry._coordinates()},ve.prototype.getCopyright=function(t){var e=this,r=e.url.match(/.*xyz+.*here\.com\/tiles\/[a-zA-Z]+[\.\d]*\//),o=e.c;t&&(null==o?r?((o=new y.Queue).add(t),e.c=o,e.getLoader().src[0].send({url:r+"copyright",responseType:"json",success:function(t){e.c=t,o.done(t);}})):t(e.c=[]):o instanceof y.Queue?o.add(t):t(o));},ve);function ve(t){t=fe.call(this,y.JSUtils.extend({loader:t.loader||new A(t),margin:0,Tile:zt,Feature:ce,preProcessor:st},t))||this;return t.c=null,t.clipped=!0,t.tree=null,t}var ge,me={backgroundColor:"#555555",strokeWidthZoomScale:function(t){return 17<t?1:14<t?.5:.25},styleGroups:{earth:[{zIndex:1,type:"Polygon",fill:"#555555"}],landuse:[{zIndex:2,type:"Polygon",fill:"#666666"}],water:[{zIndex:3,type:"Polygon",fill:"#353535"}],roads:[{zIndex:4,type:"Line",stroke:"#ffffff",strokeWidth:4}],highway:[{zIndex:5,type:"Line",stroke:"#ffffff",strokeWidth:6}],buildings:[{zIndex:6,type:"Polygon",fill:"#999999"}]},assign:function(t,e){var r=t.properties,o=r.kind,r=r.layer,t=t.geometry.type;if("water"!=r||"LineString"!=t&&"MultiLineString"!=t){if("roads"==r){if("rail"==o||"ferry"==o)return;if("highway"==o)return o}return r}}},xe=(n(_e,ge=S),_e.prototype.getProvider=function(t){t=Math.floor(t)-this.levelOffset;return this._p[t]},_e.prototype.getCopyright=function(t){this.getProvider(this.max).getCopyright(t);},_e);function _e(t){var e=t.remote,r=e.url,o=e.min||1,n=e.max||16,i=e.tileSize,a=t.name||"",s=t.max||32,l=new A(e),p=[];i||(i=(e=r.match(/256|512|1024|2048|4096/))?Number(e[0]):512);for(var u=new y.LRU(256/Math.pow(2,0)),h=new y.LRU(4*u.max),c=o;c<=n;c++)p.push({min:c,max:c==n?s:c,provider:new ye({name:a+"-L"+c,url:r,level:+c,loader:l,size:i,storage:new qt(+c,u,h)})});return ge.call(this,d(d({min:o,max:s,style:me,margin:0,pointerEvents:!1},t),{tileSize:i,providers:p}))||this}function be(t,e,r){var o=new XMLHttpRequest;return o.onload=function(){e(JSON.parse(this.responseText));},o.onreadystatechange=function(){var t=this.status;4==this.readyState&&(t<200||300<=t)&&0!==t&&r&&r(this);},o.open("GET",t,!0),o.send(),o}var Le=(we.prototype.createUrl=function(t,e){var r,o="";for(r in e=e||{})o+="&"+r+"="+encodeURIComponent(e[r]);return this.reverseUrl+"?app_id="+this.cfg.app_id+"&app_code="+this.cfg.app_code+o},we.prototype.geocode=function(t,e,r){be(this.createUrl(this.url,t),e,r);},we.prototype.reverseGeocode=function(t,e,r){be(this.createUrl(this.reverseUrl,t),e,r);},we.prototype.getIsoCountryCode=function(t,r,e){var o={mode:"retrieveAddresses",maxresults:1,jsonattributes:1};t instanceof Array?o.prox=t[1]+","+t[0]:o.prox=t.latitude+","+t.longitude,this.reverseGeocode(o,function(t){var e=null;try{e=t.response.view[0].result[0].location.address.country;}catch(t){}r&&r(e,t);},e);},we);function we(t){(t=t||{}).host=t.host||"geocoder.api.here.com",t.version=t.version||"6.2",this.url="https://"+t.host+"/"+t.version+"/geocode.json",this.reverseUrl="https://reverse."+t.host+"/"+t.version+"/reversegeocode.json",this.cfg=t;}var Te=(Me.prototype.forEach=function(t){this.cache.forEach(t);},Me.prototype.clear=function(){this.cache.clear();},Me.prototype.remove=function(t){this.cache.remove(t.quadkey);},Me.prototype.get=function(t){return this.cache.get(t)},Me.prototype.set=function(t){var e=this.cache.set(t.quadkey,t),t=this._onDrop;e&&t&&t(e);},Me.prototype.onDrop=function(t){this._onDrop=t;},Me);function Me(t){this.cache=new y.LRU(t||256);}function Pe(){return +new Date}var Se,Ee=(n(Oe,Se=Yt),Oe.prototype.getTile=function(t,e){var o,r=this.loader,n=this.storage;return void 0===(o=n.get(t))&&(n.set(o=this.createTile(t)),o.onLoaded=[]),o.loadStopTs?e&&e(o):(e&&-1==o.onLoaded.indexOf(e)&&o.onLoaded.push(e),o.loadStartTs||(o.loadStartTs=Pe(),r.tile(o,function(t){o.loadStopTs=Pe(),o.data=t;for(var e=0,r=o.onLoaded;e<r.length;e++)(0,r[e])(o);o.onLoaded=void 0;},function(t){o.loadStopTs=Pe(),o.error=t;}))),o},Oe.prototype._removeTile=function(t){t.isLoaded()||(this.storage.remove(t),this.loader.abort(t));},Oe.prototype.getLoader=function(){return this.loader},Oe.prototype.clear=function(t){var e=null;if(t instanceof Array)for(var r,e=this.getCachedTilesOfBBox(t,this.level),o=0;o<e.length;o++)r=e[o],this.storage.remove(r),e[o]=r.quadkey;else 0==arguments.length&&this.storage.clear();this.dispatchEvent("clear",{tiles:e});},Oe.prototype.cancel=function(t){t=t instanceof Ut?t:this.storage.get(t);t&&this._removeTile(t);},Oe);function Oe(t){var e=Se.call(this,d({storage:new Te(512)},t))||this;return e.name="",e.opacity=1,e.dataType="image",e.loader||(e.loader=new $t(new X({url:t.url,headers:{Accept:"*/*"}}))),e}Ee.prototype.__type="ImageProvider";var Fe,Ue,Be=(n(Ce,Fe=Kt),Ce.prototype.detectFeatureClass=function(t){switch(t.geometry.type){case"Point":return "MARKER";case"LineString":return "LINE";case"Polygon":case"MultiPolygon":return "AREA"}},Ce.prototype.getFeatureProperties=function(t){return t.properties},Ce.prototype.readRoutingPoint=function(t){return {link:this.readRoutingLink(t),position:this.readRoutingPosition(t)}},Ce.prototype.blockFeature=function(t,e){var r=t.id||t,t=typeof r;"string"!=t&&"number"!=t||(e?this.blocked[r]=!0:delete this.blocked[r]);},Ce.prototype._insert=function(t,e){return this.blocked[t.id]?null:Fe.prototype._insert.call(this,t,e)},Ce.prototype.reserveId=function(t,e){setTimeout(function(){return e(t.map(function(t){return t.id}))},0);},Ce.prototype.isoCC=function(t,e){return !0},Ce.prototype.prepareFeature=function(t){return t.properties||(t.properties={}),null==t.id&&(t.id=y.JSUtils.String.random()),t},Ce);function Ce(t){t=Fe.call(this,d({editable:!0},t))||this;return t.blocked={},t}var ke,ze="Method not implemented.",Re=(n(qe,ke=Error),qe);function qe(t,e){t=ke.call(this,t)||this;return t.name="FeatureError",t.feature=e,t}var De,Ye=(n(Xe,De=Be),Xe.prototype.getFeatures=function(t,r){var i=this;r=r||{},t instanceof Array||("object"==typeof t&&(t.remote&&(r.remote=t.remote),t.onload&&(r.onload=t.onload),t=t.ids||t.id),t=[].concat(t));var a=this,e=!0,s=r.onload,o=r.remote;(p=De.prototype.getFeatures.call(this,t))instanceof Array||(p=[p]);for(var n=0;n<p.length;n++)p[n]||(p[n]=t[n],e=!1);function l(){return 1==(p=p.map(function(t){return "object"==typeof t?t:Ue})).length?p[0]:p}if(e||!o){var p=l();return s&&s(p),p}t=p.filter(function(t){return "object"!=typeof t});function u(t){var e=r.onerror;e&&e(t);}a._requestFeatures(t,function(t){for(var e=0,r=t;e<r.length;e++){var o=r[e],n=o.geometry;if(!n||!n.type||!n.coordinates)return void u(new Re("Invalid geometry",o))}i.preprocess(t,function(t){for(var e=0,r=t;e<r.length;e++){var o=r[e];p[p.indexOf(o.id)]=a.addFeature(o);}s&&s(l());});},u,r);},Xe.prototype.cancel=function(t,e){var r=this.storage,o=e==Ue,n=t instanceof this.Tile?t:r.get(t);if(n){t=n.quadkey;for(var i,a,s=this.calcStorageQuads(t),l=0,p=void 0,u=void 0;l<s.length;l++)(p=(u=s[l])==t?n:r.get(u))&&(a=void 0,(i=p.onLoaded)&&(o?n.onLoaded.length=0:this.level&&n.z!=this.level?-1!=(a=i.indexOf(n.onLoaded[0]))&&(i[a].remove(e)||i.splice(a,1)):i.splice(i.indexOf(e),1),i.length||this.loader.abort(p)&&r.remove(p)));}},Xe.prototype.search=function(t,e){var r,o=this;if("object"==typeof t)if(e)for(var n in t)e[n]=t[n];else e=t;var i=(e=e||{}).onload,a=e.radius,s=e.remote,l=e.onerror;if(a==Ue&&(a=1),t instanceof Array)r=4==t.length?t:y.geotools.getPointBBox(t,a);else {if("number"==typeof t||"string"==typeof t||!t)return o.getFeatures(t,e);if(t.longitude!=Ue&&t.latitude!=Ue)r=y.geotools.getPointBBox([t.longitude,t.latitude],a);else if(t.minLon!=Ue&&t.minLat!=Ue&&t.maxLon!=Ue&&t.maxLat!=Ue)r=[t.minLon,t.minLat,t.maxLon,t.maxLat];else {if(a=t.point||t.rect||t.viewport)return o.search(a,e);if(t.id||t.ids)return o.getFeatures(t.id||t.ids,e)}}if(r={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]},s){for(var p,u=wt.getTilesInRect(r.minX,r.minY,r.maxX,r.maxY,o.level),h=function(t){u.splice(u.indexOf(t.quadkey),1),p=p||t.error,u.length||(p?l(p):i&&i(o._s(r)));},c=0;c<u.length;c++){var d=u[c],f=o.getCachedTile(d);if(f&&f.isLoaded()){if(f.error)return void(l&&l(f.error));u.splice(c--,1);}else o.getTile(d,h);}if(u.length)return}s=o._s(r);return i&&i(s),s},Xe.prototype.getLoader=function(){return this.loader},Xe.prototype.config=function(t){return De.prototype.config.call(this,t)},Xe.prototype.clear=function(t){0==arguments.length&&this.loader.clear(),De.prototype.clear.apply(this,arguments);},Xe.prototype.calcStorageQuads=function(t){return wt.getTilesOfLevel(t,this.level)},Xe.prototype.createTile=function(t){var e,r,o=De.prototype.createTile.call(this,t),n=o.z,i=this.level;if(i&&n!=i)if(i<n)e=t.substr(0,i),(r=(r=this.dep[e])||(this.dep[e]=[]))[r.length]=o;else if(n<i)for(var a=wt.getTilesOfLevel(t,i),s=0,l=a.length;s<l;s++)e=a[s],(r=(r=this.dep[e])||(this.dep[e]=[]))[r.length]=o;return o},Xe.prototype.execTile=function(t){var e,r=t.onLoaded;if(r){for(var o=0,n=r.length;o<n;o++)(e=r[o])instanceof ee?e.receive(t):e(t);r.length=0;}},Xe.prototype.attachData=function(t,e){for(var r,o,n=this,i=[],a=e.length,s=0;s<a;s++)!1!==(r=n.prepareFeature(o=e[s]))?(r=n._insert(o=r,t))?i[i.length]=o=r:n.tree||(i[i.length]=n.getFeature(o.id)):(e.splice(s--,1),a--);if(e=i,t.loadStopTs=Date.now(),n.tree&&n.tree.load(e),t.data=n.clipped?e:n.search(t.getContentBounds()),n.margin)for(var l=0,p=t.data.length;l<p;l++)n._mark(t.data[l],t);n.execTile(t);},Xe.prototype.getTile=function(t,e){var r,o=this,n=o.storage,i=o.level;if((r=n.get(t))==Ue)(r=o.createTile(t)).onLoaded=[],r.data=[],n.set(r);else if(r.isLoaded())return e&&e(r,r.error),r;if(t.length!=i){var a=o.calcStorageQuads(t),s=void 0,l=void 0;r.loadStartTs=Date.now(),r.onLoaded.length?l=r.onLoaded[0]:(l=new ee(r,a),r.onLoaded.push(l)),l.add(e);for(var p=0;p<a.length;p++)(s=n.get(a[p]))==Ue?s=o.getTile(a[p],l):s.isLoaded()?l.receive(s):-1==s.onLoaded.indexOf(l)&&s.onLoaded.push(l);}else e&&-1==r.onLoaded.indexOf(e)&&r.onLoaded.push(e),r.loadStartTs||(r.loadStartTs=Date.now(),o.loader.tile(r,function(t,e){o.sizeKB+=e/1024,o.preprocess(t,function(t){return o.attachData(r,t)},r);},function(t){r.loadStopTs=Date.now(),r.error=t,o.execTile(r),o.listeners.trigger("error",[t],!0);}));return r},Xe.prototype._removeTile=function(t,e){De.prototype._removeTile.call(this,t,e),t.isLoaded()||this.loader.abort(t);},Xe.prototype.readDirection=function(t){throw new Error(ze)},Xe.prototype.readPedestrianOnly=function(t){throw new Error(ze)},Xe.prototype.writeTurnRestriction=function(t,e,r){throw new Error(ze)},Xe.prototype.readRoutingProvider=function(t,e){return this.id},Xe.prototype.readRoutingPosition=function(t){throw new Error(ze)},Xe.prototype.readRoutingLink=function(t){throw new Error(ze)},Xe.prototype.writeRoutingPosition=function(t,e){throw new Error(ze)},Xe.prototype.writeRoutingLink=function(t,e){throw new Error(ze)},Xe.prototype.readTurnRestriction=function(t,e){throw new Error(ze)},Xe.prototype.writeRoutingPoint=function(t,e,r){this.writeRoutingLink(t,e),this.writeRoutingPosition(t,r);},Xe.prototype.writeEditState=function(t,e){},Xe.prototype.reserveId=function(t,e){for(var r,o=t.length,n=[];o--;)"string"==typeof(r=t[o].id)&&15<r.length?n.push(t[o].id):n.push(y.JSUtils.String.random(16));setTimeout(function(){e(n.reverse());},0);},Xe.prototype.isDroppable=function(t){t=t.editState&&t.editState();return !t||!t.modified&&!t.removed&&!t.split},Xe);function Xe(t){var e=De.call(this,d({minLevel:8,maxLevel:20,staticData:!1},t))||this;e.sizeKB=0,e._clearOnCommit=!0;var s=e,r=t.loader;if(!r)throw new Error("no tile loader defined.");r instanceof $t||(r=new $t(r)),s.loader=r;var l,r=t.preProcessor;return s.preprocess=oe(r||t.preprocessor),s.postprocess=oe(t.postProcessor),s.commit&&(s.commit=(l=s.commit,function(t,e,r){function o(t){for(var e,r=(t=!Array.isArray(t)?[t]:t).length;r--;)(e=(t[r]=N.prototype.toJSON.call(t[r])).properties)&&delete e["@ns:com:here:editor"];return t}var n,i=this,a=this.postProcessor;if("object"==typeof t&&(t.put=o(t.put||[]),t.remove=o(t.remove||[]),le(a)))return s.postprocess(t,function(t){n=l.call(i,t,e,r);}),n;return l.call(this,t,e,r)})),e}var Ie,je="Method not implemented.",Ae=(n(Ge,Ie=Ye),Ge.prototype.getHeader=function(t){var e=this.loader.src;return e[e.length-1].headers[t]||null},Ge.prototype.getHeaders=function(){var t=this.loader.src;return y.JSUtils.clone(t[t.length-1].headers)},Ge.prototype.setHeader=function(t,e){var r=this.loader.src,o=this.getHeaders();o[t]=e,r[r.length-1].headers=o,this.headers=o;},Ge.prototype.setHeaders=function(t){var e=this.loader.src,r=this.getHeaders();y.JSUtils.extend(r,t),e[e.length-1].headers=r,this.headers=r;},Ge.prototype.getParams=function(){return this.params},Ge.prototype.getParam=function(t){return this.params[t]||null},Ge.prototype.setParams=function(t){var e,r=this.loader.src,o=r[r.length-1],r=o.baseUrl,n=this.params||{};if(y.JSUtils.extend(n,t),this.params=n,"string"==typeof r){var i,n=y.JSUtils.extend((e=e||{},r.split(/\?|\&/).slice(1).map(function(t){t=t.split(/\=/),e[t[0]]=t[1];}),e),n),a=r.split(/\?/)[0],s="?";for(i in n){var l=n[i];void 0===l?delete n[i]:(a+=s+i+"="+l,s="&");}o.setUrl(a);}},Ge.prototype.setParam=function(t,e){var r={};r[t]=e,this.setParams(r);},Ge.prototype.config=function(t){return Ie.prototype.config.call(this,t),t&&t.url&&this.setParams({}),this},Ge.prototype.commit=function(t,e,r,o){throw new Error(je)},Ge.prototype._requestFeatures=function(t,e,r,o){throw new Error(je)},Ge.prototype.readZLevels=function(t){throw new Error("Method not implemented.")},Ge.prototype.writeZLevels=function(t,e){throw new Error("Method not implemented.")},Ge);function Ge(t){var e=this,r=t.loader;return r?r instanceof $t||(r=new $t(r)):r=new $t(new X({url:t.url,withCredentials:t.withCredentials,headers:t.headers})),t.loader=r,(e=Ie.call(this,t)||this).setParams(t.params||{}),e.setHeaders(t.headers||{}),e}Ae.prototype.getFeatureUrl=Ae.prototype.getLayerUrl=Ae.prototype.getTileUrl=function(){throw new Error(je)};var Ne,Je=(n(Qe,Ne=Ae),Qe);function Qe(t){return t.level=t.level||13,t.headers=y.JSUtils.extend({Accept:"application/geo+json"},t.headers||{}),Ne.call(this,t)||this}var He,Ve="Method not implemented.",Ze=(n(Ke,He=Be),Ke.prototype.cancel=function(t){},Ke.prototype.delete=function(t){this.tree.remove(t);},Ke.prototype.import=function(t){this.tree.fromJSON(t);for(var e=(t=this.tree.all()).length;e--;)this._insert(t[e]);},Ke.prototype.initStorage=function(t){},Ke.prototype.commit=function(t,e,r){return "function"==typeof e&&setTimeout(function(){return e({})},0),!0},Ke.prototype.readDirection=function(t){throw new Error(Ve)},Ke.prototype.readPedestrianOnly=function(t){throw new Error(Ve)},Ke.prototype.writeTurnRestriction=function(t,e,r){throw new Error(Ve)},Ke.prototype.readRoutingProvider=function(t,e){return this.id},Ke.prototype.readRoutingPosition=function(t){throw new Error(Ve)},Ke.prototype.readRoutingLink=function(t){throw new Error(Ve)},Ke.prototype.writeRoutingPosition=function(t,e){throw new Error(Ve)},Ke.prototype.writeRoutingLink=function(t,e){throw new Error(Ve)},Ke.prototype.readTurnRestriction=function(t,e){throw new Error(Ve)},Ke.prototype.writeRoutingPoint=function(t,e,r){this.writeRoutingLink(t,e),this.writeRoutingPosition(t,r);},Ke.prototype.readZLevels=function(t){throw new Error("Method not implemented.")},Ke.prototype.writeZLevels=function(t,e){throw new Error("Method not implemented.")},Ke.prototype.writeEditState=function(t,e){},Ke);function Ke(t){t=He.call(this,d({minLevel:8,maxLevel:20,storage:new Te(512),editable:!1,size:512},t))||this;return t._clearOnCommit=!1,delete t.level,t.editable||(t.Feature=N,t.detectFeatureClass=function(){return null}),t}var We,$e={environment:"prd",space:"",credentials:{access_token:""},withCredentials:!1,tags:!1,https:!0,clip:!1,url:null,headers:null,propertySearch:null,editable:!0,level:0},tr="@ns:com:here:xyz",er="http://",rr={prd:er+"xyz.api.here.com/hub/spaces"},or=(n(nr,We=Je),nr.prototype.config=function(t){return We.prototype.config.call(this,t)},nr.prototype.commit=function(t,e,r){function o(t){!--s&&e&&e(t);}function n(t){r&&r(t);}var i=this.loader.src,a=i[i.length-1],s=0;"object"==typeof t&&(i=t.put||[],t=t.remove||[],i.length&&(s++,a.send(this.createUpdateFeatureRequest(i,{success:o,error:n}))),t.length&&(s++,a.send(this.createRemoveFeatureRequest(t,{success:o,error:n}))));},nr.prototype.getLayerUrl=function(t){return this.url+"/"+t},nr.prototype.getTileUrl=function(t){return this._addUrlFilters(this.getLayerUrl(t)+"/tile/quadkey/{QUADKEY}?margin="+this.margin+"&clip="+!!this.clip)},nr.prototype.getFeatureUrl=function(t,e){return e instanceof Array||(e=[e]),this.getLayerUrl(t)+"/features?id="+e.join("&id=")},nr.prototype.createUpdateFeatureRequest=function(t,e){void 0===e&&(e={});var r=this._addUrlCredentials(this.getLayerUrl(this.space)+"/features","?");return d({type:"POST",url:r,headers:d(d({},this.headers),{"Content-Type":"application/geo+json"}),data:JSON.stringify({type:"FeatureCollection",features:t})},e)},nr.prototype.createRemoveFeatureRequest=function(t,e){void 0===e&&(e={});var r=this._addUrlCredentials(this.getLayerUrl(this.space)+"/features","?");return d({type:"DELETE",url:r+"&id="+t.map(function(t){return t.id}).join(","),headers:d(d({},this.headers),{Accept:"application/json"})},e)},nr.prototype.prepareFeature=function(t){var e=(t=We.prototype.prepareFeature.call(this,t)).properties;return e[tr]||(e[tr]={}),t},nr.prototype.setMargin=function(t){Je.prototype.setMargin.call(this,t),this.setUrl(this.getTileUrl(this.space));},nr.prototype.setUrl=function(t){this.loader.setUrl(this._addUrlCredentials(t));},nr.prototype.setTags=function(t){this.tags=t="string"==typeof t?[t]:t,this.setUrl(this.getTileUrl(this.space)),this.clear();},nr.prototype.setPropertySearch=function(t,e,r){var o,n,i="";for(n in "string"==typeof t?(o={})[t]={operator:e,value:r}:o=t,o){var a=o[n];e=a.operator.replace(">=","=gte=").replace("<=","=lte=").replace(">","=gt=").replace("<","=lt="),r=(r=!((r=null==a.values?a.value:a.values)instanceof Array)?[r]:r).map(function(t){return "string"==typeof t&&(!y.JSUtils.isNumeric(t)&&"true"!=t&&"false"!=t&&"null"!=t||(t='"'+t+'"')),encodeURIComponent(t)});a=n.slice(0,2);i+=(n="f."!=a&&"p."!=a?"p."+n:n)+e+r+"&";}this.psf=i.slice(0,-1),this.setUrl(this.getTileUrl(this.space)),this.clear();},nr.prototype.getCopyright=function(e,t){this.getDefinition(function(t){e&&e(t.copyright||[]);},t);},nr.prototype.getDefinition=function(t,e){var r,o=this,n=o.getLoader().src,i=o.definition;null==i&&(r=new y.Queue,i=this.definition=r,n[n.length-1].send({url:o._addUrlCredentials(o.getLayerUrl(o.space),"?"),key:"def",success:function(t){o.definition=t,r.done(t);},error:function(t){o.definition=[],e&&e(t);},headers:d(d({},this.headers),{Accept:"application/json"})})),t&&(i instanceof y.Queue?i.add(t):t(i));},nr.prototype._requestFeatures=function(t,e,r,o){var n=this.loader.src;n[n.length-1].send({key:t.join("&"),url:this._addUrlCredentials(this.getFeatureUrl(this.space,t)),success:function(t){e(t.features);},headers:this.headers,error:r});},nr.prototype._addUrlCredentials=function(t,e){return t=function(t,e,r){for(var o in e)t+=r+o+"="+e[o],r="&";return t}(t,this.params,e||"&")},nr.prototype._addUrlFilters=function(t){var e=this.tags,r=this.psf;return e&&e.length&&(t+="&tags="+e.join(",")),r&&(t+="&"+r),t},nr);function nr(t){var e,r,e=We.call(this,(e=t,r=arguments[1],(e=y.JSUtils.extend(y.JSUtils.clone($e),e)).params=y.JSUtils.extend(e.params||{},e.credentials),delete e.credentials,se(r)&&(e.preProcessor=r),e.url||(e.url=rr[e.environment]),e.https&&(e.url=e.url.replace(er,"https://")),e))||this;return e.definition=null,e.setUrl(e.getTileUrl(e.space)),t.propertySearch&&e.setPropertySearch(t.propertySearch),e}var ir,ar=(n(sr,ir=or),sr.prototype.addRequestToken=function(t){return (t.headers=t.headers||{}).Authorization="Bearer "+this.token,t},sr.prototype.createUpdateFeatureRequest=function(t,e){return this.addRequestToken(ir.prototype.createUpdateFeatureRequest.call(this,t,e=void 0===e?{}:e))},sr.prototype.createRemoveFeatureRequest=function(t,e){return this.addRequestToken(ir.prototype.createRemoveFeatureRequest.call(this,t,e=void 0===e?{}:e))},sr.prototype.getLayerUrl=function(t){return this.url+"/catalogs/"+this.catalog+"/layers/"+t},sr);function sr(t){var e=ir.call(this,function(t){t=d(d({url:"http://interactive.data.api.platform.here.com/interactive/v1",https:!0,space:t.layer},t),{credentials:d({},t.credentials)});return delete t.credentials.token,t}(t))||this;return e.definition=[],e.token=null===(t=t.credentials)||void 0===t?void 0:t.token,e}var lr=xt,pr=d({name:"xyz-maps"},{version:"0.23.0",revision:"d65f7d4",date:"2021-06-22T12:33:32Z"}),ur=r.global.here.xyz.maps;ur.common=r;u=ur.geo={Point:l,Rect:p},h=ur.pixel={Point:i,Rect:s},c=ur.layers={TileLayer:S,MVTLayer:xe},St=ur.features={Feature:N},Ct=ur.tile={Tile:Ut,Utils:wt};ur.build=pr;Ft=ur.providers={ImageProvider:Ee,GeoJSONProvider:Je,FeatureProvider:Kt,LocalProvider:Ze,RemoteTileProvider:pe,EditableRemoteTileProvider:Ye,SpaceProvider:or,IMLProvider:ar,MVTProvider:ye,EditableFeatureProvider:Be},ae=ur.projection={webMercator:lr},Ae=ur.loaders={HTTPLoader:X,Manager:$t},ur=ur.service||{Geocoder:Le},r={tile:Ct,layers:c,geo:u,pixel:h,features:St,providers:Ft,projection:ae,loaders:Ae,service:ur,build:pr,common:r};t.DEFAULT_LAYER_MAX_ZOOM=32,t.DEFAULT_LAYER_MIN_ZOOM=15,t.EditableFeatureProvider=Be,t.EditableRemoteTileProvider=Ye,t.Feature=N,t.FeatureProvider=Kt,t.GeoCoder=Le,t.GeoJSONProvider=Je,t.GeoPoint=l,t.GeoRect=p,t.IMLProvider=ar,t.ImageProvider=Ee,t.LocalProvider=Ze,t.MVTLayer=xe,t.MVTProvider=ye,t.PixelPoint=i,t.PixelRect=s,t.RemoteTileProvider=pe,t.SpaceProvider=or,t.Tile=Ut,t.TileLayer=S,t.build=pr,t.default=r,t.features=St,t.layers=c,t.loaders=Ae,t.pixel=h,t.projection=ae,t.providers=Ft,t.service=ur,t.tile=Ct,t.tileUtils=wt,t.utils=Nt,t.webMercator=lr,Object.defineProperty(t,"__esModule",{value:!0});});

    let XYZ_MAPS;

    try {
        XYZ_MAPS = here.xyz.maps;
    } catch (e) {
        XYZ_MAPS = {};
        window.here = {xyz: {maps: XYZ_MAPS}};
    }

    var XYZ_MAPS$1 = XYZ_MAPS;

    return XYZ_MAPS$1;

})));

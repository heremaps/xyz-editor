/*
 * @here/xyz-maps-common
 * (c) 2019-2021 HERE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t=t||self).here=t.here||{},t.here.xyz=t.here.xyz||{},t.here.xyz.maps=t.here.xyz.maps||{},t.here.xyz.maps.common={}))}(this,function(t){"use strict";var a="undefined"!=typeof window?window:global,h=0,e=(n.prototype.start=function(){return this.manager.start(this)},n.prototype.restart=function(t){void 0===t&&(t={}),this.cancel(),this.canceled=!1,this.paused=!1,this.delayed=null,this.heap=null,t.init&&(this.init=t.init),t.priority&&(this.priority=t.priority),t.onDone&&(this.onDone=t.onDone),this.start()},n.prototype.init=function(){},n.prototype.cancel=function(){return this.manager.cancel(this)},n);function n(t,e,n,r,i,o,s,a){this.id=++h,this.exec=n,r&&(this.init=r),this.delay=0^a,this.name=s,this.time=i||100,this.priority=Math.max(Math.min(0^e,5),1),this.manager=t,o&&(this.onDone=o)}e.prototype.CONTINUE=!0,e.prototype.BREAK=!1,e.prototype.onDone=null,e.prototype.heap=null,e.prototype.paused=!1,e.prototype.delayed=null,e.prototype.yielded=!1,e.prototype.canceled=!1;var r,i=1e3/60,o=0,s=(u.prototype.runner=function(t){var e,n,r,i,o,s,a,h=this,u=!0;if(t=t||h.now(),h.active){for(;(u=h.now()-t<h.time)&&(h.task=i=h._next());){for(o=a=!1,s=i.paused?(i.paused=!1,i.heap):(e=h.now(),i.init());!o;)if(n=e||h.now(),o=!i.exec(s)||i.canceled,n=(r=h.now())-n,r=r-t>h.time,h.task=e=null,!o&&(i.paused||n>=i.time)||r){if(o||(h._insert(h.task=i,!0),i.paused=!0,i.heap=s),r)return o&&!i.canceled&&i.onDone&&i.onDone(s),h._resume();a=!0;break}a||(i.paused=!1,i.heap=null,!i.canceled&&i.onDone&&i.onDone(s))}if(!u)return h._resume();h.active=!1}else h._resume()},u.prototype.setExclusiveTime=function(t){this.time=0^t},u.prototype._next=function(){var t,e=this,n=e.queue,r=n[0][0],i=e.now();if(r&&i>=r.delayed)return e._delayed&&a.clearTimeout(e._delayed),e.queue[0].shift();for(var o=1,s=n.length;o<s;o++)if(t=n[o].shift())return t;r&&(e._delayed&&a.clearTimeout(e._delayed),e._delayed=a.setTimeout(function(){e._delayed=null,e.active=!0,e.runner()},r.delayed-i))},u.prototype.create=function(t){return new e(this,t.priority,t.exec,t.init,t.time,t.onDone,t.name,t.delay)},u.prototype._insert=function(t,e){if(t.delay){t.delayed=this.now()+t.delay;for(var n,r,i=0,o=(n=this.queue[0]).length-1;i<=o;)if(n[r=(i+o)/2|0].delayed>t.delayed)o=r-1;else if(i=1+r,n[r].delayed==t.delayed)break;n.splice(i,0,t)}else n=this.queue[t.priority],e?n.unshift(t):n.push(t)},u.prototype.isWaiting=function(t){return-1!=this.queue[t.delay?0:t.priority].indexOf(t)},u.prototype.start=function(t,e){var n=this.task;t!=n&&(t.canceled=!1,this._insert(t),this.active?n&&n.priority>t.priority&&(n.paused=!0):(this.active=!!e,this.runner()))},u.prototype.cancel=function(t){t.canceled=!0,t.paused=!1;var e=t==this.task,n=t.delay?0:t.priority,n=this.queue[n],t=n.indexOf(t);return-1!=t&&n.splice(t,1),e&&(this.task=null),e},u);function u(t){this.time=i,this._delayed=null,this.now=Date.now;var e,n=this;n.queue=[[],[],[],[],[],[]],n.id=o++,n.active=!1,1<t&&(n.time=t||i),a.postMessage?(e="tm-"+n.id,a.addEventListener("message",function(t){t.source==a&&t.data==e&&(t.stopPropagation(),n.runner())},!0),n._resume=function(){n.active=!0,a.postMessage(e,"*")}):n._resume=function(){n.active=!0,setTimeout(n.runner.bind(n),0)}}function c(t,e,n){for(var r=-1,i=0;i<t.length;i++)if(t[i][0]==e&&t[i][1]==n){r=i;break}return r}var p,l={getInstance:function(t){return r?"number"==typeof t&&(r.time=t):r=this.createInstance(t),r},createInstance:function(t){return this.active=!0,new s(t)},active:!1},f=(y.prototype.addEvent=function(t){this._l[t]||(this._l[t]=[],this._exec[t]=p)},y.prototype.sync=function(t){return this._sync=!!t,this},y.prototype.removeEvent=function(t){delete this._l[t]},y.prototype.getEvents=function(){var t,e=[];for(t in this._l)e[e.length]=t;return e},y.prototype.get=function(t){t=this._l[t];return t&&t.slice()},y.prototype.isDefined=function(t){return!!this._l[t]},y.prototype.isListened=function(t){return this._l[t]&&this._l[t].length},y.prototype.add=function(t,e,n){var r=!1;return this._l.hasOwnProperty(t)&&-1==c(this._l[t],e,n)&&(this._l[t].push([e,n]),r=!0),r},y.prototype.remove=function(t,e,n){if(this._l.hasOwnProperty(t)){n=c(this._l[t],e,n);if(-1!=n)return this._exec[t]--,this._l[t].splice(n,1),!0}return!1},y.prototype.trigger=function(t,e,n,r){var i=!1;if(this._l[t]){var o=this._l[t].length;for(this._exec[t]=0;this._exec[t]<o;this._exec[t]++){var s,a,i=!0;(a=this._l[t][this._exec[t]])&&(r&&!r(a)||(s=a[0],a=a[1],n||this._sync?Array.isArray(e)?s.apply(a,e):s.call(a,e):function(t,e,n){setTimeout(function(){Array.isArray(n)?t.apply(e,n):t.call(e,n)},0)}(s,a,e)))}this._exec[t]=p}return i},y);function y(t){this._l={},this._sync=!1,this._exec={};for(var e=0;e<t.length;e++)this.addEvent(t[e])}var d=function(t,e){this.key=t,this.data=e};d.prototype.data=null,d.prototype.next=null,d.prototype.prev=null;var v=(_.prototype.setSize=function(t){if(this.length>t)for(var e=this.length-t;e--;)this.remove(this.tail.key);this.max=t},_.prototype.get=function(t){var e,n;return(e=this._[t])&&(e!=this.head&&(this.tail==e&&(this.tail=e.next),n=e.prev,t=e.next,n&&(n.next=e.next||e),t&&(t.prev=n),(n=this.head)&&(n.next=e),e.prev=this.head,e.next=null,this.head=e),e=e.data),e},_.prototype.toArray=function(){for(var t=[],e=this.tail,n=0;e;)t[n++]=e.data,e=e.next;return t},_.prototype.forEach=function(t){for(var e=this.tail,n=0;e;)t(e.data,n++),e=e.next},_.prototype.clear=function(){this._={},this.head=null,this.tail=null,this.length=0},_.prototype.remove=function(t){var e,n,r;return(e=this._[t])&&(n=e.prev,r=e.next,n&&(n.next=r),r&&(r.prev=n),r||(this.head=n),n||(this.tail=r),delete this._[t],e=e.data,this.length--),e},_.prototype.set=function(t,e){var n,r;return(n=this._[t])?(n.data=e,n!=this.head&&this.get(t)):(this.length==this.max?(r=this.tail.data,delete this._[this.tail.key],this.tail=this.tail.next,this.tail.prev=null):this.length++,n=new d(t,e),this._[t]=n,(t=this.head)?(n.prev=t).next=n:this.tail=n,this.head=n),r},_);function _(t){this.length=0,this.head=null,this.tail=null,this.max=t||5e3,this._={},this.tail=null}function g(a,r,t){t=t||M;var i=a.indexOf("["),o=a.lastIndexOf("]");t.create({name:"PJA",priority:4,time:4,onDone:function(t){var e,n;r&&(n=void 0,n=(e=t.elements).length?-1!=a.indexOf('"type":"FeatureCollection"')?((t=JSON.parse(a.substr(0,i+1)+a.substr(o))).features=e,t):e:JSON.parse(a),r(n))},init:function(){return{i:i,open:0,start:null,len:o,elements:[],grp:20,last:null}},exec:function(t){var e,n,r,i,o=t.elements,s=t.len;if(t.i<s){for(;(e=t.i++)<s;)if('"'!=(n=a.charAt(e)))if("{"==n)t.open++,null==t.start&&(t.start=e);else if("}"==n){if(0==--t.open)return--t.grp&&e<s-2||(t.grp=20,o.push.apply(o,JSON.parse("["+a.slice(t.start,t.last=1+e)+"]")),t.start=null),this.CONTINUE}else 0!=t.open||isNaN(n)||(20!=t.grp&&(i=e-1,(r=t).grp=20,r.elements.push.apply(r.elements,JSON.parse("["+a.slice(r.start,i)+"]")),r.start=null),r=(i=a.substr(e)).search("[0-9](]|,)")+1,o.push(parseFloat(i.substring(0,r))),t.i=e+r);else t.i=a.indexOf('"',1+e)+1;20!=t.grp&&null!=t.last&&o.push.apply(o,JSON.parse("["+a.slice(t.last+1,a.lastIndexOf("]"))+"]"))}}}).start()}function m(t,e){for(var n in e)"constructor"!=n&&(t[n]=e[n]);return t}var M=l.getInstance(13),x=function(t,e,n){if(null==n||"object"!=typeof n)return n;if(n.constructor!=Object&&n.constructor!=Array)return n;if(n.constructor==Date||n.constructor==RegExp||n.constructor==Function||n.constructor==String||n.constructor==Number||n.constructor==Boolean)return new n.constructor(n);for(var r in e=e||new n.constructor,n)e[r]=x(t,t?e[r]:null,n[r]);return e},b=function(t){var e,n;if("object"!=typeof t)return t;if(!t)return t;if("[object Array]"===Object.prototype.toString.apply(t)){for(e=[],n=0;n<t.length;n+=1)e[n]=b(t[n]);return e}for(n in e={},t)t.hasOwnProperty(n)&&(e[n]=b(t[n]));return e},O={loglevel:"debug",dump:function(t,e){var n=!!O.loglevel,r=Array.prototype.slice.call(arguments),i=r[r.length-1],o=window.console;return n&&o&&(i in o?r.pop():i="log",!0!=n&&n!==i||(Function.prototype.bind&&"object"==typeof o.log?Function.prototype.bind.call(o[i],o):o[i]).apply(o,r)),O},extend:function(t,e,n){return"boolean"!=typeof t&&(n=e,e=t,t=!1),x(t,e,n)},clone:b,createObject:Object.create||function(t){function e(){}return e.prototype=t,new e},inheritClass:function(t,e,n){var r,i=e.prototype,o=t.prototype;for(r in"object"==typeof e&&((n=e).constructor==Object.prototype.constructor&&(e.constructor=function(){t.apply(this,arguments)}),e=e.constructor),e.prototype=O.createObject(o),i&&i!=Object.prototype&&m(e.prototype,i),t)e[r]=t[r];return n&&m(e.prototype,n),e},isFunction:function(t){return"function"==typeof t},isNumeric:function(t){return!isNaN(+t)&&isFinite(t)},isPlainObject:function(t){if(!t||"object"!=typeof t||t.nodeType||t==t.window)return!1;try{if(t.constructor&&!t.hasOwnProperty("constructor")&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(t){return!1}for(var e in t);return void 0===e||t.hasOwnProperty(e)},String:{round:function(t,e){return e?Number(t.toFixed(e)):Math.round(t)},random:function(t){t=t||16;for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz",r=n.length,i=0;i<t;i++)e+=n.charAt(Math.random()*r^0);return e}}},w=Math.PI/180,P=180/Math.PI,N=6371e3,j={calcBearing:function(t,e){var n=Math.PI/180,r=t[1]*n,i=e[1]*n,t=t[0]*n,e=e[0]*n;return(Math.atan2(Math.cos(r)*Math.sin(i)-Math.sin(r)*Math.cos(i)*Math.cos(e-t),Math.sin(e-t)*Math.cos(i))/n+360)%360},movePoint:function(t,e,n,r){var i=e/(r=void 0===r?N:r),e=n*w,r=t[1]*w,n=t[0]*w,t=Math.asin(Math.sin(r)*Math.cos(i)+Math.cos(r)*Math.sin(i)*Math.cos(e));return[((n+Math.atan2(Math.sin(e)*Math.sin(i)*Math.cos(r),Math.cos(i)-Math.sin(r)*Math.sin(t))+3*Math.PI)%(2*Math.PI)-Math.PI)*P,t*P]},getPointBBox:function(t,e){var n=t[1],r=t[0],t=Math.asin(e/(N*Math.cos(Math.PI*n/180)))*P,e=Math.asin(e/N)*P;return[r-t,n-e,r+t,n+e]},mergeBBoxes:function(t,e){return t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t},extendBBox:function(t,e){var n=Math.abs(Math.asin(e/(N*Math.cos(t[0]*w))))*P,r=Math.abs(Math.asin(e/(N*Math.cos(t[2]*w))))*P,e=Math.abs(Math.asin(e/N))*P;return[t[0]-n,t[1]-e,t[2]+r,t[3]+e]},distance:function(t,e){var n=w*(e[1]-t[1]),r=w*(e[0]-t[0]),r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(w*t[1])*Math.cos(w*e[1])*Math.sin(r/2)*Math.sin(r/2),r=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return N*r}},k=(z.prototype.add=function(t){var e=!this.has(t);return e&&(this.size=this._.push(t)),e},z.prototype.clear=function(){this.size=this._.length=0},z.prototype.delete=function(t){var e=this._.indexOf(t),t=-1!=e;return t&&(this._.splice(e,1),this.size--),t},z.prototype.has=function(t){return-1!=this._.indexOf(t)},z.prototype.toArray=function(){return this._.slice(0)},z);function z(t){if(this.size=0,this._=[],t)for(var e=0;e<t.length;e++)this.add(t[e])}var A=(E.prototype.clear=function(){this.size=0,this._={}},E.prototype.delete=function(t){var e=this.has(t);return e&&(delete this._[t],this.size--),e},E.prototype.get=function(t){return this._[t]},E.prototype.has=function(t){return null!=this._[t]},E.prototype.set=function(t,e){var n=!this.has(t);return n&&(this.size++,this._[t]=e),n},E.prototype.values=function(){var t,e=this._,n=[];for(t in e)n[n.length]=e[t];return n},E.prototype.keys=function(){var t,e=[];for(t in this._)e[e.length]=t;return e},E.prototype.forEach=function(t){var e,n=this._;for(e in n)t(n[e],e,this)},E);function E(t){if(this._={},this.size=0,t)for(var e=0;e<t.length;e++)this.set(t[e][0],t[e][1])}var I=(S.prototype.add=function(t){if("function"==typeof t)return this.queue.push(t)},S.prototype.done=function(t,e,n){for(var r=this.queue;r.length;)r.shift().apply(void 0,arguments)},S);function S(){this.queue=[]}var D=a;"here.xyz.maps".split(".").forEach(function(t){return D=D[t]=D[t]||{}}),a.HERE=a.here;var q={LRU:v,TaskManager:l,Listener:f,parseJSONArray:g,JSUtils:O,geotools:j,global:a,Queue:I,Set:k,Map:A};D.common=q,t.JSUtils=O,t.LRU=v,t.Listener=f,t.Map=A,t.Queue=I,t.Set=k,t.TaskManager=l,t.default=q,t.geotools=j,t.global=a,t.parseJSONArray=g,Object.defineProperty(t,"__esModule",{value:!0})});
